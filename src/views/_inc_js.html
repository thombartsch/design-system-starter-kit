<script src="/scripts/jquery.caret.min.js"></script>
<script src="/scripts/jquery.tag-editor.js"></script>

<script>
    $(document).ready(function() {
        //HOVER NAV ITEM
        //navigator
        /*
            //DRAG DROP MOVE AROUND
            var count = 0;

            //START DRAG DROP JQUERY
            $('.draggable').draggable({
                revert: true,
                connectToSortable: '.list',
                helper: 'clone',
                start: function(event, ui) {
                    //console.log('start');

                },
                stop: function(event, ui) {
                    var navtxt = $(ui.helper).attr('title');
                    //console.log('navtxt:' + navtxt);

                    savingAnimation();

                    ui.helper.css('width', '100%');

                    ui.helper.children('.add-component').fadeOut(600);
                    ui.helper.children('div.component').fadeToggle().toggleClass('slds-hide slds-show');

                    //add navigator item
                    var get_case = $(this).closest('li').attr('id');
                    var nav_item = '<li role="treeitem" aria-level="3" class="slds-item nav slds-padding_n" id="navigator_placeholder_' + count + '"><div class="slds-tree__item"><span class="slds-tree__item-label slds-truncate" title="' + navtxt + '"><button class="slds-button slds-button__small hoverme button-trigger-action--edit-component-' + get_case + ' ">' + navtxt + '</button><button class="slds-button slds-button__small slds-float_right trash"><svg class="slds-button__icon slds-button__icon_left" aria-hidden="true"><use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#delete"></use></svg></button></span></div></li>';


                    $(nav_item).attr('id', 'navigator_placeholder_' + count);
                    $(nav_item).addClass('listItem' + count);
                    $(nav_item).attr('indexer', 'listItem' + count);
                    ui.helper.addClass('listItem' + count);
                    ui.helper.attr('indexer', 'listItem' + count);
                    $('#navigator_list').append(nav_item);


                    //add id to placeholder
                    $(this).addClass('ui-draggable-dragged');
                    ui.helper.attr('id', 'component_placeholder_' + count);
                    //$('#emptyRegion').fadeOut(600);



                    count++;


                    $('.button-trigger-action--edit-component-row').click(function() {
                        var component_type = 'row';
                        $('#string_editor').html('Row');

                        $('.draggable .slds-drop-zone__container').removeClass('slds-is-hovered');
                        $(this).closest('.draggable .slds-drop-zone__container').toggleClass('slds-is-hovered');
                        var activeComponent = $(this).closest('.draggable').attr('id');

                        var str = $(this).closest('li').attr('id');
                        var editstring = str.split('placeholder_');
                        var editit = editstring[1];
                        //console.log('check for editing: ' + editit);

                        $('#panel_editor .slds-panel').removeClass('slds-size_x-large');
                        $('#panel_editor .slds-panel').addClass('slds-size_medium');
                        showProperties(component_type, activeComponent);
                    });


                    $('.button-trigger-action--edit-component-banner').click(function() {
                        var component_type = 'banner';
                        $('#string_editor').html('Banner');

                        $('.draggable .slds-drop-zone__container').removeClass('slds-is-hovered');
                        $(this).closest('.draggable .slds-drop-zone__container').toggleClass('slds-is-hovered');
                        var activeComponent = $(this).closest('.draggable').attr('id');

                        var str = $(this).closest('li').attr('id');
                        var editstring = str.split('placeholder_');
                        var editit = editstring[1];
                        //console.log('check for editing: ' + editit);

                        var banner_value = $('#component_placeholder_' + editit + ' .image-holder').attr('src');
                        //console.log('image ist: ' + banner_value);

                        if (typeof banner_value === 'undefined') {
                            $('.image-figure-thumb').attr('src', '/assets/placeholder.png');
                            $('.file-name').text('Please select an image');
                        } else {
                            $('.image-figure-thumb').attr('src', '' + banner_value + '');
                            $('.file-name').text(banner_value);
                        }

                        var header1_value = $('#component_placeholder_' + editit + ' .banner-header').html();
                        //console.log('header 1 ist: ' + header1_value);
                        $('input.text-banner-header').val(header1_value);

                        var header2_value = $('#component_placeholder_' + editit + ' .banner-sub').html();
                        //console.log('header 2 ist: ' + header2_value);
                        $('input.text-banner-sub').val(header2_value);



                        $('#panel_editor .slds-panel').removeClass('slds-size_x-large');
                        $('#panel_editor .slds-panel').addClass('slds-size_medium');
                        showProperties(component_type, activeComponent);
                    });

                    $('.button-trigger-action--edit-component-category').click(function() {
                        var component_type = 'category';
                        $('#string_editor').html('Category');


                        $('input.text-banner-header-product').val('');
                        $('input.product-link').val('');

                        $('.draggable .slds-drop-zone__container').removeClass('slds-is-hovered');
                        $(this).closest('.draggable .slds-drop-zone__container').toggleClass('slds-is-hovered');
                        var activeComponent = $(this).closest('.draggable').attr('id');

                        var str = $(this).closest('li').attr('id');
                        var editstring = str.split('placeholder_');
                        var editit = editstring[1];
                        //console.log('check for editing: ' + editit);

                        var banner_value = $('#component_placeholder_' + editit + ' .image-holder').attr('src');
                        //console.log('image ist: ' + banner_value);

                        if (typeof banner_value === 'undefined') {
                            $('.image-figure-thumb').attr('src', '/assets/placeholder.png');
                            $('.file-name').text('Please select a category');
                        } else {
                            $('.image-figure-thumb').attr('src', '' + banner_value + '');
                            $('.file-name').text(banner_value);
                        }

                        var call_button = $('#component_placeholder_' + editit + ' .call-to-action').html();
                        //console.log('button ist: ' + call_button);
                        $('input.text-banner-header-product').val(call_button);




                        $('#panel_editor .slds-panel').removeClass('slds-size_x-large');
                        $('#panel_editor .slds-panel').addClass('slds-size_medium');
                        showProperties(component_type, activeComponent);
                    });


                    $('.button-trigger-action--edit-component-rtf').click(function() {
                        var component_type = 'rtf';
                        $('#string_editor').html('Rich Text');

                        $('.draggable .slds-drop-zone__container').removeClass('slds-is-hovered');
                        $(this).closest('.draggable .slds-drop-zone__container').toggleClass('slds-is-hovered');
                        var activeComponent = $(this).closest('li').attr('id');
                        //console.log('active component is: ' + activeComponent);

                        var str = $(this).closest('li').attr('id');
                        var editstring = str.split('placeholder_');
                        var editit = editstring[1];
                        //console.log('check for editing: ' + editit);

                        $('#panel_editor .slds-panel').addClass('slds-size_x-large');
                        $('#panel_editor .slds-panel').removeClass('slds-size_medium');
                        showProperties(component_type, activeComponent);
                    });




                    $('#canvas_list .slds-drop-zone').mouseenter(function() {
                        var str = $(this).closest('#canvas_list li.draggable').attr('id');
                        var listitem = str.split('component_placeholder_');
                        var item = listitem[1];
                        $('#navigator_placeholder_' + item).removeClass('nav');
                        $('#navigator_placeholder_' + item).addClass('nav-hover');
                    });
                    $('#canvas_list .slds-drop-zone').mouseout(function() {
                        var str = $(this).closest('#canvas_list li.draggable').attr('id');
                        var listitem = str.split('component_placeholder_');
                        var item = listitem[1];
                        $('#navigator_placeholder_' + item).removeClass('nav-hover');
                        $('#navigator_placeholder_' + item).addClass('nav');
                    });





                    $('#navigator_list li .slds-tree__item').mouseenter(function() {
                        //on hover show the sub menu and change the background color
                        $(this).closest('#navigator_list li.slds-item').removeClass('nav');
                        $(this).closest('#navigator_list li.slds-item').addClass('nav-hover');
                        //now get the id and then highlight the related component
                        var str = $(this).closest('#navigator_list li.slds-item').attr('id');
                        var listitem = str.split('navigator_placeholder_');
                        var item = listitem[1];
                        $('#canvas_list #component_placeholder_' + item + ' .slds-drop-zone__container').addClass('slds-is-hovered');
                    });



                    $('#navigator_list li').mouseout(function() {
                        //on hover show the sub menu and change the background color
                        $(this).closest('#navigator_list li.slds-item').addClass('nav');
                        $(this).closest('#navigator_list li.slds-item').removeClass('nav-hover');
                        $('#canvas_list .slds-drop-zone__container').removeClass('slds-is-hovered');
                    });

                    $('.hoverme').click(function() {
                        //scroll to div in canvas
                    });




                    $('.list button.button-trigger-action--delete-component , .trash').click(function() {
                        var activeComponentPlaceholder = undefined;
                        var activeNavigationPlaceholder = undefined;

                        var activeComponentPlaceholder = $(this).closest('li').attr('id');
                        if (activeComponentPlaceholder.match('navigator_placeholder_')) {

                            arr = activeComponentPlaceholder.split('navigator_placeholder_');
                            var activeNavigationPlaceholder = 'navigator_placeholder_' + arr[1];
                            var activeComponentPlaceholder = 'component_placeholder_' + arr[1];
                            arr = undefined;
                        }
                        if (activeComponentPlaceholder.match('component_placeholder_')) {
                            arr = activeComponentPlaceholder.split('component_');
                            var activeNavigationPlaceholder = 'navigator_' + arr[1];
                            arr = undefined;
                        }
                        $('#modal-id-4-delete').removeClass('slds-hide');
                        //DELETE ANY COMPONENT
                        $('.js-trigger-delete-component, .action-delete-component').click(function() {
                            $('#' + activeComponentPlaceholder).remove();
                            $('#' + activeNavigationPlaceholder).remove();

                            $('#modal-id-4-delete').addClass('slds-hide');
                            activeComponentPlaceholder = undefined;
                            activeNavigationPlaceholder = undefined;


                            if ($('#canvas_list > li.draggable').length != 0) {} else {
                                $('.component_properties').addClass('slds-hide');
                                $('.component_properties .placeholder').toggleClass('slds-hide');
                            }
                            return false;
                        });
                    });
                }
            });
            $('.draggable').disableSelection();

            $('#navigator_list').sortable({

                start: function(event, ui) {
                    oldIndex = ui.item.index();
                    $(this).addClass('sortable-hover');
                },
                stop: function(event, ui) {
                    newIndex = ui.item.index();
                    newIndex = newIndex - 1;
                    var str = ui.item.attr('id');
                    var listitem = str.split("navigator_placeholder_");
                    var moveitem = listitem[1];
                    if (oldIndex > newIndex) {
                        $('#component_placeholder_' + moveitem).insertBefore('#canvas_list li:eq(' + newIndex + ')');
                        //console.log('insertBefore: ' + newIndex);
                    } else {
                        $('#component_placeholder_' + moveitem).insertAfter('#canvas_list li:eq(' + newIndex + ')');
                        //console.log('insertAfter: ' + newIndex);

                    };
                    $('#navigator_list').removeClass('sortable-hover');
                    savingAnimation();

                }
            });
            $('#navigator_list').disableSelection();



            $('.list').sortable({
                revert: true,
                placeholder: 'ui-sortable-helper',
                start: function(event, ui) {
                    list_width = $('#canvas_list, #static_header').width();
                    oldIndex = ui.item.index();
                    //console.log('old index was: ' + oldIndex);
                    ui.helper.css('height', 'auto');
                    ui.helper.css('width', list_width);
                    $('ul,li').disableSelection();
                },
                stop: function(event, ui, ) {
                    newIndex = ui.item.index();
                    newIndex = newIndex - 1;
                    //console.log('new index is: ' + newIndex);
                    var str = ui.item.attr('id');
                    var listitem = str.split("component_placeholder_");
                    var moveitem = listitem[1];
                    //console.log('move item is: ' + moveitem);


                    if (oldIndex > newIndex) {
                        //console.log('insertBefore: ' + newIndex);
                        $('#navigator_placeholder_' + moveitem).insertBefore('#navigator_list li:eq(' + newIndex + ')');
                    } else {
                        //console.log('insertAfter: ' + newIndex);
                        $('#navigator_placeholder_' + moveitem).insertAfter('#navigator_list li:eq(' + newIndex + ')');
                    }
                    savingAnimation();
                },

            });
            $('.list').disableSelection();


            //END WORKING SORTING JQUERY

        }

        */

        //PREVIEW HANDLING
        $('#trigger-preview-desktop').click(function() {
            //console.log('trigger desktop resolution');
            $('#listEditor').removeClass('desktop');
            $('#listEditor').removeClass('tablet_portrait');
            $('#listEditor').removeClass('phone_portrait');
            $('#static_header').removeClass('desktop');
            $('#static_header').removeClass('tablet_portrait');
            $('#static_header').removeClass('phone_portrait');

            $('#listEditor').addClass('desktop');
            $('#static_header').addClass('desktop');
            return false;
        });
        $('#trigger-preview-tablet_portrait').click(function() {
            //console.log('trigger tablet portrait resolution');
            $('#listEditor').removeClass('desktop');
            $('#listEditor').removeClass('tablet_portrait');
            $('#listEditor').removeClass('phone_portrait');
            $('#static_header').removeClass('desktop');
            $('#static_header').removeClass('tablet_portrait');
            $('#static_header').removeClass('phone_portrait');

            $('#listEditor').addClass('tablet_portrait');
            $('#static_header').addClass('tablet_portrait');
            return false;
        });
        $('#trigger-preview-phone_portrait').click(function() {
            //console.log('trigger phone portrait resolution');
            $('#listEditor').removeClass('desktop');
            $('#listEditor').removeClass('tablet_portrait');
            $('#listEditor').removeClass('phone_portrait');
            $('#static_header').removeClass('desktop');
            $('#static_header').removeClass('tablet_portrait');
            $('#static_header').removeClass('phone_portrait');

            $('#listEditor').addClass('phone_portrait');
            $('#static_header').addClass('phone_portrait');
            return false;
        });



        //SAVING ANIMATION
        function savingAnimation() {
            $('#status_txt').css('opacity', '1');
            $('#status_txt').delay(500).fadeOut(1000, function() {
                $('#status_txt').text('Saving ...');
            }).fadeIn(1000).delay(500).fadeOut(1000, function() {
                $('#status_txt').text('Saved');
            }).fadeIn(1000);
            $('#status_txt').css('opacity', '0.5');
        }



        //NAVIGATOR
        function showNavigation() {}

        function showProperties(component_type, activeComponent) {

            //console.log('called editor and now the activeComponent is: ' + activeComponent);
            //console.log('called editor and now the component_type is: ' + component_type);

            $('#panel_editor .component_properties').addClass('slds-hide');
            $('#editor_' + component_type).removeClass('slds-hide');
            $('#editor_' + component_type).addClass('slds-show');

            //activate tab general
            $('#editor_' + component_type + ' .tab_general').addClass('slds-active');
            $('#editor_' + component_type + ' .tab_rules').removeClass('slds-active');

            $('#editor_' + component_type + ' .tab_general_content').addClass('slds-show');
            $('#editor_' + component_type + ' .tab_general_content').removeClass('slds-hide');

            $('#editor_' + component_type + ' .tab_rules_content').removeClass('slds-show');
            $('#editor_' + component_type + ' .tab_rules_content').addClass('slds-hide');

            $('.text-activeComponent').val(activeComponent);
            $('.text-componentType').val(component_type);

            $('#panel_editor').removeClass('slds-hide');
        }

        //MEDIA SELECTOR
        $('#panel_right .slds-panel__close').click(function() {
            $('#panel_right').addClass('slds-hide');
            return false;
        });


        //Toggle Tab General
        $('.tab_general').click(function() {
            $('.tab_general').addClass('slds-active');
            $('.tab_rules').removeClass('slds-active');

            $('.tab_general_content').addClass('slds-show');
            $('.tab_general_content').removeClass('slds-hide');
            $('.tab_rules_content').removeClass('slds-show');
            $('.tab_rules_content').addClass('slds-hide');
            return false;
        });

        $('.tab_rules').click(function() {
            $('.tab_general').removeClass('slds-active');
            $('.tab_rules').addClass('slds-active');

            $('.tab_general_content').removeClass('slds-show');
            $('.tab_general_content').addClass('slds-hide');
            $('.tab_rules_content').addClass('slds-show');
            $('.tab_rules_content').removeClass('slds-hide');
            return false;
        });





        //GALLERY BROWSING
        $('.select_collectionA').click(function() {
            $('.select_collectionA').addClass('slds-is-selected');
            $('.collectionA').removeClass('slds-hide');

            $('.select_collectionB').removeClass('slds-is-selected');
            $('.collectionB').addClass('slds-hide');

            $('.select_collectionC').removeClass('slds-is-selected');
            $('.collectionC').addClass('slds-hide');

            $('.select_collectionD').removeClass('slds-is-selected');
            $('.collectionD').addClass('slds-hide');

            $('.select_collectionG').removeClass('slds-is-selected');
            $('.collectionG').addClass('slds-hide');
            return false;
        });


        $('.select_collectionB').click(function() {
            $('.select_collectionB').addClass('slds-is-selected');
            $('.collectionB').removeClass('slds-hide');

            $('.select_collectionA').removeClass('slds-is-selected');
            $('.collectionA').addClass('slds-hide');

            $('.select_collectionC').removeClass('slds-is-selected');
            $('.collectionC').addClass('slds-hide');

            $('.select_collectionD').removeClass('slds-is-selected');
            $('.collectionD').addClass('slds-hide');

            $('.select_collectionG').removeClass('slds-is-selected');
            $('.collectionG').addClass('slds-hide');
            return false;
        });


        $('.select_collectionC').click(function() {
            $('.select_collectionC').addClass('slds-is-selected');
            $('.collectionC').removeClass('slds-hide');

            $('.select_collectionB').removeClass('slds-is-selected');
            $('.collectionB').addClass('slds-hide');

            $('.select_collectionA').removeClass('slds-is-selected');
            $('.collectionA').addClass('slds-hide');

            $('.select_collectionD').removeClass('slds-is-selected');
            $('.collectionD').addClass('slds-hide');

            $('.select_collectionG').removeClass('slds-is-selected');
            $('.collectionG').addClass('slds-hide');
            return false;
        });

        $('.select_collectionD').click(function() {
            $('.select_collectionD').addClass('slds-is-selected');
            $('.collectionD').removeClass('slds-hide');

            $('.select_collectionB').removeClass('slds-is-selected');
            $('.collectionB').addClass('slds-hide');

            $('.select_collectionA').removeClass('slds-is-selected');
            $('.collectionA').addClass('slds-hide');

            $('.select_collectionC').removeClass('slds-is-selected');
            $('.collectionC').addClass('slds-hide');

            $('.select_collectionG').removeClass('slds-is-selected');
            $('.collectionG').addClass('slds-hide');
            return false;
        });


        $('.select_collectionG').click(function() {
            $('.select_collectionG').addClass('slds-is-selected');
            $('.collectionG').removeClass('slds-hide');

            $('.select_collectionB').removeClass('slds-is-selected');
            $('.collectionB').addClass('slds-hide');

            $('.select_collectionA').removeClass('slds-is-selected');
            $('.collectionA').addClass('slds-hide');

            $('.select_collectionC').removeClass('slds-is-selected');
            $('.collectionC').addClass('slds-hide');

            $('.select_collectionD').removeClass('slds-is-selected');
            $('.collectionD').addClass('slds-hide');
            return false;
        });






        //MEDIA SELECTOR
        $('.add-mediaselector-dummy').click(function() {
            //console.log('media selector called');
            selected_image = undefined;
            $('.mediaselector-component-editor .image-figure-thumb').attr('src', '/assets/placeholder.png');
            $('.mediaselector-component-editor .file-name').html('No Image assigned');


            $('#banner-checkbox_everyone').prop('checked', false);
            $('#banner-checkbox_customergroupa').prop('checked', false);
            $('#banner-checkbox_customergroupb').prop('checked', false);

            //now open editor
            activeComponent = undefined;
            activeComponent = $(this).closest('li').attr('id');

            //add 1 to component count
            regionlimit = $('#' + closest_region + '_links .region_limit').text();
            regionlimit = Number(regionlimit) + 1;

            $('#' + closest_region + '_links .region_limit').text('');
            $('#' + closest_region + '_links .region_limit').text(regionlimit);

            $('.region_component_selector').toggleClass('slds-hide');
            $('.mediaselector-component-editor').toggleClass('slds-hide');

            $('.modal-content-id-37 .tab_general').addClass('slds-active');
            return false;
        });

        //BANNER COMPONENT
        $('.mediaselector-component-editor .image-figure, .add-image').click(function() {
            callerComponent = 'banner';
            $('.media-picker').toggleClass('slds-hide');
            $('.image_chooser').toggleClass('slds-hide');
        });

        $('.media-component button.js-trigger-edit-component').click(function() {
            activeComponent = undefined;
            activeComponent = $(this).closest('li').attr('id');

            $('#banner-checkbox_everyone').prop('checked', false);
            $('#banner-checkbox_customergroupa').prop('checked', false);
            $('#banner-checkbox_customergroupb').prop('checked', false);


            //SET CHECKBOX VALUES
            if ($('#' + activeComponent).hasClass('Everyone')) {
                $('#banner-checkbox_everyone').prop('checked', true);
            }
            if ($('#' + activeComponent).hasClass('CustomergroupA')) {
                $('#banner-checkbox_customergroupa').prop('checked', true);
            }
            if ($('#' + activeComponent).hasClass('CustomergroupB')) {
                $('#banner-checkbox_customergroupb').prop('checked', true);
            }


            return false;
        });


        $('.media-component-editor button.trigger-save-modal').click(function() {
            activeComponent = $('.text-active-component').val();
            selected_text = $('.slds-rich-text-area__content').html();
            selected_header = $('.slds-input-header').val();
            $('#' + activeComponent + ' .text-holder').html(selected_text);
            $('#' + activeComponent + ' .header-holder').html(selected_header);
            //console.log('the active component: ' + activeComponent);
            savingAnimation();
            return false;
        });

        //IMAGE SELECT
        $('.image-thumb').click(function() {
            selected_image = $(this).closest('a').find('img').attr('src');
            //alert(selected_image);

            //console.log('selected image: ' + selected_image);
            $('.slds-file_card').removeClass('selected');
            $(this).closest('.slds-file_card').addClass('selected');
            $('li').removeClass('selected');
            $(this).closest('li').addClass('selected');
            //console.log('image selected: ' + selected_image);
            return false;
        });

        //IMAGE SAVE
        $('.picker .trigger-save-modal').click(function() {
            //console.log('close picker and set image: ' + selected_image)
            $('#editor_banner .image-figure-thumb').attr('src', selected_image);
            $('#editor_banner .file-name').text(selected_image);
            $('.picker').addClass('slds-hide');
            //$('.circle').toggleClass('slds-hide');
            /*
            if (callerComponent == 'banner') {
                $('#editor_banner .image-figure-thumb').attr('src', selected_image);
                $('#editor_banner .file-name').text(selected_image);
                $('.picker').addClass('slds-hide');
                //$('.circle').toggleClass('slds-hide');
                //$('.mediaselector-component-editor').toggleClass('slds-hide');
            } else {
                $('#editor_banner .image-figure-thumb').attr('src', selected_image);
                $('#editor_banner .file-name').text(selected_image);
                $('.picker').addClass('slds-hide');
                //$('.circle').toggleClass('slds-hide');
                $('.product-component-editor').toggleClass('slds-hide');

            }
            */
        });

        //NOW SET IMAGE TO PLACEHOLDER
        $('#panel_editor .trigger-save-modal').click(function(selected_image) {

            component_type = $('.text-componentType').val()

            if (component_type === 'banner') {
                //console.log('component type is: ' + component_type);
                var activeComponent = $('#editor_banner .text-activeComponent').val();
                var selected_image = $('#editor_banner .file-name').text();

                $('#' + activeComponent + ' .component .placeholder').addClass('slds-hide');
                $('#' + activeComponent + ' .component .image-holder').removeClass('slds-hide');

                $('#' + activeComponent + ' .component .image-holder').css('background-image', 'url(' + selected_image + ')');
                $('#' + activeComponent + ' .component .image-holder').attr('src', selected_image);

                banner_header = $('#editor_banner .text-banner-header').val();
                banner_sub = $('#editor_banner .text-banner-sub').val();
                $('#' + activeComponent + ' .banner-header').html(banner_header);
                $('#' + activeComponent + ' .banner-sub').html(banner_sub);
            }
            if (component_type === 'category') {
                //console.log('component type is: ' + component_type);
                var activeComponent = $('#editor_category .text-activeComponent').val();
                var selected_image = $('#editor_category .file-name').text();

                $('#' + activeComponent + ' .component .placeholder').addClass('slds-hide');
                $('#' + activeComponent + ' .component .image-holder').removeClass('slds-hide');

                $('#' + activeComponent + ' .component .image-holder').css('background-image', 'url(' + selected_image + ')');
                $('#' + activeComponent + ' .component .image-holder').attr('src', selected_image);

                call_button = $('#editor_category .text-banner-header-product').val();

                //console.log('button text should be: ' + call_button);

                $('#' + activeComponent + ' button.call-to-action').html(call_button);

            }
            if (component_type === 'row') {}


        });



        /*

        //BANNER COMPONENT EDIT
        $('.placeholder-component-37 .js-trigger-edit-component, .js-trigger-media-edit-component').click(function() {
            alert();
            activeComponent = undefined;
            activeComponent = $(this).closest('li').attr('id');

            $('#banner-checkbox_everyone').prop('checked', false);
            $('#banner-checkbox_customergroupa').prop('checked', false);
            $('#banner-checkbox_customergroupb').prop('checked', false);


            //SET CHECKBOX VALUES
            if ($('#' + activeComponent).hasClass('Everyone')) {
                $('#banner-checkbox_everyone').prop('checked', true);
            }
            if ($('#' + activeComponent).hasClass('CustomergroupA')) {
                $('#banner-checkbox_customergroupa').prop('checked', true);
            }
            if ($('#' + activeComponent).hasClass('CustomergroupB')) {
                $('#banner-checkbox_customergroupb').prop('checked', true);
            }



            //GET IMAGE
            //imgUrl = $(this).closest('.placeholder').find('.image-holder').css('background-image');
            imgUrl = $('#' + activeComponent).find('.image-holder').css('background-image');

            patt = /\"|\'|\)/g;
            selected_image = '/assets/' + imgUrl.split('/').pop().replace(patt, '');

            //GET TEXTS
            banner_header = $('#' + activeComponent).find('.title').text();
            banner_sub = $('#' + activeComponent).find('.sub').text();

            $('.mediaselector-component-editor .image-figure-thumb').attr('src', selected_image);

            //SET TAB
            $('.modal-content-id-37 .tab_general').addClass('slds-active');
            $('.mediaselector-component-editor .text-banner-header').val(banner_header);
            $('.mediaselector-component-editor .text-banner-sub').val(banner_sub);
            $('.mediaselector-component-editor').toggleClass('slds-hide');
        });



        $('.js-trigger-media-edit-rules').click(function() {
            activeComponent = undefined;
            activeComponent = $(this).closest('li').attr('id');

            if (activeComponent.match('_links')) {
                arr = activeComponent.split('_');
                activeComponent = arr[0];
                arr = undefined;
            }

            $('#banner-checkbox_everyone').prop('checked', false);
            $('#banner-checkbox_customergroupa').prop('checked', false);
            $('#banner-checkbox_customergroupb').prop('checked', false);


            //SET CHECKBOX VALUES
            if ($('#' + activeComponent).hasClass('Everyone')) {
                $('#banner-checkbox_everyone').prop('checked', true);
            }
            if ($('#' + activeComponent).hasClass('CustomergroupA')) {
                $('#banner-checkbox_customergroupa').prop('checked', true);
            }
            if ($('#' + activeComponent).hasClass('CustomergroupB')) {
                $('#banner-checkbox_customergroupb').prop('checked', true);
            }



            //GET IMAGE
            //imgUrl = $(this).closest('.placeholder').find('.image-holder').css('background-image');
            imgUrl = $('#' + activeComponent).find('.image-holder').css('background-image');

            patt = /\"|\'|\)/g;
            selected_image = '/assets/' + imgUrl.split('/').pop().replace(patt, '');

            //GET TEXTS
            banner_header = $('#' + activeComponent).find('.title').text();
            banner_sub = $('#' + activeComponent).find('.sub').text();

            $('.mediaselector-component-editor .image-figure-thumb').attr('src', selected_image);

            //SET TAB
            $('.modal-content-id-37 .tab_rules').addClass('slds-active');
            $('.mediaselector-component-editor .text-banner-header').val(banner_header);
            $('.mediaselector-component-editor .text-banner-sub').val(banner_sub);
            $('.mediaselector-component-editor').toggleClass('slds-hide');

            //SET CHECKBOX VALUES
            if ($('#' + activeComponent).hasClass('Everyone')) {
                $('#banner-checkbox_everyone').prop('checked', true);
            }
            if ($('#' + activeComponent).hasClass('CustomergroupA')) {
                $('#banner-checkbox_customergroupa').prop('checked', true);
            }
            if ($('#' + activeComponent).hasClass('CustomergroupB')) {
                $('#banner-checkbox_customergroupb').prop('checked', true);
            }


        });

*/






        //PRODUCT PICKER SELECT COMPONENT
        $('.add-product').click(function() {
            $('.product-component-editor').toggleClass('slds-hide');
            $('#cat-pick').toggleClass('slds-hide');
            //$('.product-picker').toggleClass('slds-hide');
            /*
            $('#picker-tabs').toggleClass('slds-hide');
            $('#tab-default-2').toggleClass('slds-show');
            $('#select-search').toggleClass('slds-show');
            $('#combobox-unique-id1').toggleClass('slds-show');
            */

            return false;
        });


        //FILTER PRODUCT TABLE

        $("#kwd_search").keyup(function() {
            if ($(this).val() != "") {
                $("#my-table tbody>tr").hide();
                $("#my-table td:contains-ci('" + $(this).val() + "')").parent("tr").show();
            } else {
                $("#my-table tbody>tr").show();
            }
        });
        $.extend($.expr[":"], {
            "contains-ci": function(elem, i, match, array) {
                return (elem.textContent || elem.innerText || $(elem).text() || "").toLowerCase().indexOf((match[3] || "").toLowerCase()) >= 0;
            }
        });


        //SELECT PRODUCT
        $('.slds-checkbox_faux').click(function() {
            selected_product_name = undefined;
            selected_product_brand = undefined;
            selected_product_price = undefined;
            selected_product_id = undefined;


            selected_product_name = $(this).closest('tr').find('.product-name').html();
            selected_product_brand = $(this).closest('tr').find('.product-brand').html();
            selected_product_price = $(this).closest('tr').find('.product-price').html();
            selected_product_image = $(this).closest('tr').find('.prod_img').attr('src');
        });

        $('.product-picker button.trigger-save-modal').click(function() {

            $('.product-picker').toggleClass('slds-hide');
            $('.product-component-editor').toggleClass('slds-hide');

            $('.product-picker div.list-empty').toggleClass('slds-hide');
            $('.product-picker div.list-full').toggleClass('slds-hide');

            $('.product-link').val(selected_product_name);

            return false;
        });

        $('#select-all-products').click(function() {
            $('.product-list .slds-checkbox_add-button input').prop('checked', true);
            $('.hrhr-1').removeAttr('disabled');
            $('#deselect-all-products, .deselect-all-products, #items-selected-more').toggleClass('slds-hide');
            $(this).toggleClass('slds-hide');
        });

        $('#deselect-all-products').click(function() {
            $('.product-list .slds-checkbox_add-button input').prop('checked', false);
            $('#select-all-products, .deselect-all-products, #items-selected-more').toggleClass('slds-hide');
            $(this).toggleClass('slds-hide');
            $('.slds-button_brand.hrhr-1').attr('disabled', 'disabled');
        });



        // Nested Categories Commerce Selector
        $('#trigger-nested').click(function() {
            $('.slds-is-child').toggleClass('slds-hide');
            $(this).toggleClass('is-opened');
        });

        $('.app-trigger').click(function() {
            $(this).toggleClass('slds-is-open');
        });

        $('.hide-select-product-2').click(function() {
            $('#select-product-23').toggleClass('slds-hide');
            $('#select-product-23').toggleClass('slds-show');
        });

        $('.slds-checkbox_faux').click(function() {
            $('#items-selected, #remove-all-trigger').removeClass('slds-hide');
            $('.einstein-placeholder-item').addClass('slds-hide');
            $('.einstein-item').removeClass('slds-hide');
            $('.hrhr-1').removeAttr('disabled');
        });

        $('#remove-all-trigger').click(function() {
            $('#remove-all-trigger, #items-selected').addClass('slds-hide');
            $('.product-list .slds-checkbox_add-button input').prop('checked', false);
            $('.hrhr-1').prop('disabled', true);
        });

        $('#combobox-unique-id1').change(function() {
            $('#tab-default-1, #placeholder-img, #item-counter, #empty-state-text').toggleClass('slds-hide');
        });

        $('#combobox-unique-id2').change(function() {
            $('.product-tile[aria-level="2"], .product-tile[aria-level="3"]').removeAttr('aria-level');
            $('.trigger-nested, .cat-path').toggleClass('slds-hide');
        });

        $('.hrhr').click(function() {
            var $checkbox = $('input.is-child');
            $checkbox.toggleClass('is-inhereted');
        });

        $('.hide-assign-to').click(function() {
            $('#assign-to').toggleClass('slds-hide');
        });

        $('.slds-section__title-action').click(function() {
            $(this).parent().parent().toggleClass('slds-is-open');
        });

        $('.is-child.is-inhereted + .slds-checkbox_faux').click(function() {
            $(this).removeClass('is-inhereted');
        });



        $('#select-product').click(function() {
            $('#select-intro, #picker-tabs, #select-search, #empty-state, #combobox-unique-id2').toggleClass('slds-hide');
        });

        $('#select-category').click(function() {
            $('#select-intro, #picker-tabs, #select-search, #tab-default-2, #combobox-unique-id1').toggleClass('slds-hide');
            $('#tab-default-2').toggleClass('slds-show');
        });


        $('.is-child.is-inhereted + .slds-checkbox_faux').click(function() {
            $(this).removeClass('is-inhereted');
        });

        $('#picker-tabs .checker').on('change', function() {
            if (this.checked) {
                $('#picker-tabs .checker').prop('disabled', true);
                $(this).prop('disabled', false);
                //var checked_cat = $('label[for="'+ $this.attr('id') +'"]');
                checked_cat = $(this).closest('.slds-checkbox_add-button').find('.checker').attr('id');
                $('#assign-success').prop('disabled', false);
            } else {
                $('#picker-tabs .checker').prop('disabled', false);
                checked_cat = '';
                $('#assign-success').prop('disabled', true);
            }
        })

        $('#assign-success, .hrhr-1').click(function() {
            $('#picker-tabs .checker').prop('checked', false);
            $('#picker-tabs .checker').prop('disabled', false);
            $('#picker-tabs .checker').removeClass('is-inhereted');
            $('#assign-success').prop('disabled', true);


            $('.image-figure-thumb').attr('src', 'assets/' + checked_cat + '.jpg');
            selected_image = 'assets/' + checked_cat + '.jpg';
            $('.file-name').text('assets/' + checked_cat + '.jpg');
            $('.product-link').val(checked_cat);
            $('#cat-pick').toggleClass('slds-hide');
            //$('.product-component-editor').toggleClass('slds-hide');
        });





        //MODAL HANDLERS
        $('.trigger-close-modal').click(function() {
            $(this).closest('.modal').toggleClass('slds-hide');
            return false;
        });


        //SIDE PANEL COLLAPSE EXPAND
        $('#panel_left .slds-panel__close').click(function() {
            $('#panel_left').removeClass('left_expanded');
            $('#panel_left').addClass('left_collapsed');
            $('#panel_left .slds-dropdown__header').addClass('slds-hide');
            $('#button_left_expand').toggleClass('slds-hide');
            return false;
        });

        $('#button_left_expand').click(function() {
            $('#panel_left').removeClass('left_collapsed');
            $('#panel_left').addClass('left_expanded');
            $('#panel_left .slds-dropdown__header').removeClass('slds-hide');
            $('#button_left_expand').toggleClass('slds-hide');
            return false;
        });



        //POPOVER PREVIEW SETTINGS
        $('#trigger-show-customer-groups').click(function() {
            $('#popover-customer-groups').addClass('slds-hide');
            $('#popover-date').addClass('slds-hide');
            $('#popover-more').addClass('slds-hide');

            new Tether({
                element: '.tether-box',
                target: '.trigger-tether',
                attachment: 'bottom left',
                targetAttachment: 'bottom left',
                targetModifier: 'visible',
                offset: '-10px 6px',
            });
            $('#popover-customer-groups').toggleClass('slds-hide');
            return false;
        });
        $('#trigger-show-date').click(function() {
            $('#popover-customer-groups').addClass('slds-hide');
            $('#popover-date').addClass('slds-hide');
            $('#popover-more').addClass('slds-hide');

            new Tether({
                element: '.tether-boxB',
                target: '.trigger-tetherB',
                attachment: 'bottom left',
                targetAttachment: 'bottom left',
                targetModifier: 'visible',
                offset: '-10px 6px',
            });
            $('#popover-date').toggleClass('slds-hide');
            return false;
        });


        $('#trigger-show-more').click(function() {
            $('#popover-customer-groups').addClass('slds-hide');
            $('#popover-date').addClass('slds-hide');
            $('#popover-more').addClass('slds-hide');

            new Tether({
                element: '.tether-boxC',
                target: '.trigger-tetherC',
                attachment: 'bottom left',
                targetAttachment: 'bottom left',
                targetModifier: 'visible',
                offset: '-10px 6px',
            });
            $('#popover-more').toggleClass('slds-hide');
            return false;
        });




        $('#trigger-preview').click(function() {
            $('#pd-menu').addClass('slds-hide');
            $('#panel_editor').addClass('slds-hide');

            $('#panel_left').toggleClass('slds-hide');
            $('#panel_right').toggleClass('slds-hide');
            //$('.slds-drop-zone').toggleClass('slds-drop-zone slds-drop-zone_none');
            $('.component').toggleClass('component component-preview');
            $('#trigger-preview').toggleClass('slds-hide');
            $('#trigger-edit').toggleClass('slds-hide');
            $('#dropzone1>div').toggleClass('slds-drop-zone');
            $('#canvas_list, #static_header').removeClass('transparent');
            $('#listEditor').removeClass('edit-mode');
            return false;
        });
        $('#trigger-edit').click(function() {
            $('#pd-menu').removeClass('slds-hide');
            $('#panel_editor').removeClass('slds-hide');


            $('#panel_left').toggleClass('slds-hide');
            $('#panel_right').toggleClass('slds-hide');
            //$('.slds-drop-zone').toggleClass('slds-drop-zone_none slds-drop-zone');
            $('.component-preview').toggleClass('component-preview component');
            $('#trigger-preview').toggleClass('slds-hide');
            $('#trigger-edit').toggleClass('slds-hide');
            $('#dropzone1>div').toggleClass('slds-drop-zone');
            $('#canvas_list, #static_header').addClass('transparent');
            $('#listEditor').addClass('edit-mode');

            return false;
        });


        $('#popover-preview-settings button').click(function() {
            $('#popover-preview-settings').toggleClass('slds-hide');
            return false;
        });

        $('#button-navigator').click(function() {
            $('#panel_right').toggleClass('slds-hide');
            return false;
        });



        //SET FOCAL Point
        // Credit: https://github.com/jonom/jquery-focuspoint
        // Credit: https://github.com/jonom/jquery-focuspoint

        //$('.focal-holder').css('background-image','url('+$('.set-focal-point').attr('src')+')');

        $('.set-focal-point').click(function(e) {

            var imageW = $(this).width();
            var imageH = $(this).height();

            //Calculate FocusPoint coordinates
            var offsetX = e.pageX - $(this).offset().left;
            var offsetY = e.pageY - $(this).offset().top;

            //Calculate CSS Percentages
            var percentageX = (offsetX / imageW) * 100;
            //var percentageY = (offsetY/imageH)*100;
            //there must be a bug in here ... why is *10 working???
            var percentageY = (offsetY / imageH) * 10;
            var backgroundPosition = percentageX.toFixed(0) + '% ' + percentageY.toFixed(0) + '%';

            //Move indicator
            $('.circle').css('top', (offsetY - 10) + 'px');
            $('.circle').css('left', (offsetX - 10) + 'px');
            // Set positioning
            $('.focal-holder').css('background-position', backgroundPosition);


        });




        //PAGE SETTINGS
        $('#js-trigger-page-settings').click(function(e) {
            $('#modal-page-settings').toggleClass('slds-hide');
        });

        //PAGE LIST
        $('#js-trigger-page-list').click(function(e) {
            $('#popover_page-list').toggleClass('slds-hide');
        });



        //PUBLISH
        $('#trigger-publish').click(function() {
            $('#modal-publish').toggleClass('slds-hide');
        });


        //PD MENU

        $('.js-component-palette-button').click(function() {
          //$('.js-component-palette-button').removeClass('pd-button-is-active');
          $('.js-component-palette-button').removeClass('is-active');
          $('#component-palette-menu').addClass('slds-hide');
          //$('.js-page-structure-button').removeClass('pd-button-is-active');
          $('.js-page-structure-button').removeClass('is-active');
          $('#page-structure-menu').addClass('slds-hide');
          $('#modal-page-settings').addClass('slds-hide');

          /*
          $('#page-structure-menu').addClass('slds-hide');
          $('#component-palette-menu').addClass('slds-hide');
          $('#modal-page-settings').addClass('slds-hide');
          $('.js-component-palette-button').addClass('pd-button-is-active');
          $('.js-page-structure-button').addClass('pd-button-is-active');
          */


          //$('.js-component-palette-button').addClass('pd-button-is-active');
          $('.js-component-palette-button').addClass('is-active');
          $('#component-palette-menu').removeClass('slds-hide');
        });
        $('.js-page-structure-button').click(function() {
          $('.js-component-palette-button').removeClass('is-active');
          $('#component-palette-menu').addClass('slds-hide');
          $('.js-page-structure-button').removeClass('is-active');
          $('#page-structure-menu').addClass('slds-hide');
          $('#modal-page-settings').addClass('slds-hide');

          /*
          $('#page-structure-menu').addClass('slds-hide');
          $('#component-palette-menu').addClass('slds-hide');
          $('#modal-page-settings').addClass('slds-hide');
          $('.js-component-palette-button').addClass('pd-button-is-active');
          $('.js-page-structure-button').addClass('pd-button-is-active');
          */

          //$('.js-page-structure-button').toggleClass('pd-button-is-active');
          $('.js-page-structure-button').toggleClass('is-active');
          $('#page-structure-menu').toggleClass('slds-hide');
        });
        $('.js-page-settings-button').click(function() {
          $('.js-component-palette-button').removeClass('is-active');
          $('#component-palette-menu').addClass('slds-hide');
          $('.js-page-structure-button').removeClass('is-active');
          $('#page-structure-menu').addClass('slds-hide');
          $('#modal-page-settings').addClass('slds-hide');

          /*
          $('#page-settings-general').removeClass('slds-active');
          $('#page-settings-seo').removeClass('slds-active');
          $('#page-settings-rules').removeClass('slds-active');
          $('#tab-default-11').removeClass('slds-show');
          $('#tab-default-21').removeClass('slds-show');
          $('#tab-default-31').removeClass('slds-show');
          $('#tab-default-32').removeClass('slds-show');

          $('#tab-default-11').addClass('slds-hide');
          $('#tab-default-21').addClass('slds-hide');
          $('#tab-default-31').addClass('slds-hide');
          $('#tab-default-32').addClass('slds-hide');

          $('#tab-default-11').addClass('slds-show');
          */

          $('#page-settings-general').addClass('slds-active');
          $('#modal-page-settings').toggleClass('slds-hide');
        });

        /*
        $('#region1').hover(function(){
          console.log('in');
          $('#dropzone1').toggleClass('slds-drop-zone');
          $('#dropzone1').toggleClass('slds-drop-zone_drag');
          return false;
        });
        */


        //CLOSE PD Panels
        $('#component-palette-menu .js-trigger-close').click(function(e) {
            console.log('close component palette now');
            $('.js-component-palette-button').removeClass('is-active');
            $('#component-palette-menu').addClass('slds-hide');
        });

        $('#page-structure-menu .js-trigger-close').click(function(e) {
            //console.log('close component palette now');
            $('.js-page-structure-button').removeClass('is-active');
            $('#page-structure-menu').addClass('slds-hide');
        });


        //DROPBOX Chooser
        $('.dropbox_chooser').click(function() {
            $('.image_chooser').toggleClass('slds-hide');
            options = {
                success: function(files) {
                    //alert("Here's the file link: " + files[0].link)
                    //$('.image-figure-thumb').appendChild(li).appendChild(a).appendChild(img);
                    var selected_image = files[0].link;

                    if (selected_image.indexOf("?") > 0) {
                        var clean_image = selected_image.substring(0, selected_image.indexOf("?"));
                        selected_image = clean_image + '?raw=1';
                        $('.image-figure-thumb').attr('src', selected_image);
                        $('.file-name').html(selected_image);
                        $('.file-name').attr('title', selected_image);

                        //alert(image);
                        //selected_image = undefined;
                    }
                    linkType: "preview";
                    multiselect: false;
                    extensions: ['png', 'jpg']
                },
            }
            //console.log('call dropbox');
            Dropbox.choose(options);
        });


        $('.open-menu-select').click(function() {
            $('.image_chooser').toggleClass('slds-hide');
        });


        //TODAY' DATE
        var d = new Date();

        var month = d.getMonth() + 1;
        var day = d.getDate();

        var output = d.getFullYear() + '/' +
            (('' + month).length < 2 ? '0' : '') + month + '/' +
            (('' + day).length < 2 ? '0' : '') + day;
        $('input.display-filter').attr('placeholder', output);
        //console.log('date is: ' + output);




        $('.code-view').click(function() {
            //console.log('show code view');
            $('#modal-code').toggleClass('slds-hide');
        });


        //COUNT DOWN WORDING IN PAGE Setting
            var page_title = 70;
            $('#spn-id-seo_title').html(page_title + ' characters remaining');

            $('#input-seo_title').keyup(function() {
                var text_length = $('#input-seo_title').val().length;
                var text_remaining = page_title - text_length;

                $('#spn-id-seo_title').html(text_remaining + ' characters remaining');
            });
            var page_description = 160;
            $('#spn-id-seo_description').html(page_description + ' characters remaining');

            $('#textarea-id-seo_description').keyup(function() {
                var text_length = $('#textarea-id-seo_description').val().length;
                var text_remaining = page_description - text_length;

                $('#spn-id-seo_description').html(text_remaining + ' characters remaining');
            });


            /*

            $(function() {
                $win.on('click.Bst', function(event) {
                    //MAIN COMPONENT SELECT
                    if (
                        $box.has(event.target).length == 0 //checks if descendants of $box was clicked
                        &&
                        !$box.is(event.target) //checks if the $box itself was clicked
                        &&
                        $($box).hasClass('slds-is-open')
                    ) {
                        $($box).toggleClass('slds-is-open')
                    }
                    //LOCALIZATION SELECT
                    if (
                        $boxb.has(event.target).length == 0 //checks if descendants of $box was clicked
                        &&
                        !$boxb.is(event.target) //checks if the $box itself was clicked
                        &&
                        $($boxb).hasClass('slds-is-open')
                    ) {
                        $($boxb).toggleClass('slds-is-open')
                    }
                    //DEVICE SELECT
                    if (
                        $boxc.has(event.target).length == 0 //checks if descendants of $box was clicked
                        &&
                        !$boxc.is(event.target) //checks if the $box itself was clicked
                        &&
                        $($boxc).hasClass('slds-is-open')
                    ) {
                        $($boxc).toggleClass('slds-is-open')
                    }
                    //SUB LEFT SELECT
                    if (
                        $boxd.has(event.target).length == 0 //checks if descendants of $box was clicked
                        &&
                        !$boxd.is(event.target) //checks if the $box itself was clicked
                        &&
                        $($boxd).hasClass('slds-is-open')
                    ) {
                        $($boxd).toggleClass('slds-is-open')
                    }
                    //SUB RIGHT SELECT
                    if (
                        $boxe.has(event.target).length == 0 //checks if descendants of $box was clicked
                        &&
                        !$boxe.is(event.target) //checks if the $box itself was clicked
                        &&
                        $($boxe).hasClass('slds-is-open')
                    ) {
                        $($boxe).toggleClass('slds-is-open')
                    }


                });

                return false;
            });
            */

          $('#locale-switch').click(function() {
              $('#locale-switch .slds-dropdown-trigger_click').toggleClass('slds-is-open');
          });

            //LOCALES
            $('#trigger-us').click(function() {
                $('#language-selecta li').removeClass('slds-is-selected');
                $(this).closest('li').addClass('slds-is-selected');
            });
            $('#trigger-fr').click(function() {
                $('#language-selecta li').removeClass('slds-is-selected');
                $(this).closest('li').addClass('slds-is-selected');
                $('#locale-warning').toggleClass('slds-hide');

            });
            $('#trigger-de').click(function() {
                $('#language-selecta li').removeClass('slds-is-selected');
                $(this).closest('li').addClass('slds-is-selected');
            });

          $('#locale-warning .js-trigger-close').click(function() {
              $('#locale-warning').toggleClass('slds-hide');
          });

            //create tags as you type - page SETTINGS
            /*
            $('#meta-keywords').tagEditor({
                clickDelete: true,
                initialTags: [],
                placeholder: 'Enter tags ...'
            });
            */
        //- end js

    });
</script>


<!-- Latest Sortable -->
<script src = "/scripts/Sortable.js"></script>
<script>
    var countess = 0;

    Sortable.create(listTools, {
        animation: 200,
        group: {
          name: "shared",
          pull: "clone",
          put: false,
          ghostClass: "sortable-ghost",
          revertClone: true,
          handle: '.my-handle'
        },
        sort: false,
        onClone: function(evt) {
          console.log('clone now from A');
          var origEl = evt.item;
          var cloneEl = evt.clone;
        },
        onMove: function(evt){
          console.log('moving now');

          if (evt.from == evt.to){
            console.log('is the same');
            $(evt.to).toggleClass('hover');
          //HOVER OVER REGION SHOW HIDE
        }else{
          console.log('over');
          //$(evt.to).toggleClass('off');
          //$('#region1').hover(function(){
            console.log('hover over region in');
            $('#dropzone1').addClass('slds-drop-zone');
            $('#dropzone1').addClass('slds-drop-zone_drag');
            return false;
          //});
        }

        },
        onEnd: function (evt){
          console.log('tools finished');
          console.log('tools old index is: '+evt.oldIndex)
          console.log('tools new index is: '+evt.newIndex)
          $('#region1').hover(function(){
            $('#dropzone1').removeClass('slds-drop-zone');
            $('#dropzone1').removeClass('slds-drop-zone_drag');
            return false;
          });
        }
    });

    /*
    */

    Sortable.create(listToolsB, {
        animation: 200,
        group: {
          name: "shared",
          pull: "clone",
          put: false,
          ghostClass: "sortable-ghost",
          revertClone: true,
          handle: '.my-handle'
        },
        sort: false,
        onClone: function(evt) {
          //console.log('clone now');
          var origEl = evt.item;
          var cloneEl = evt.clone;
        },
        /*
        onMove: function(evt){
          console.log('moving now');
          //HOVER OVER REGION SHOW HIDE
          $('#listEditor').hover(function(){
            console.log('hover over region in');
            $('#dropzone1').addClass('slds-drop-zone');
            $('#dropzone1').addClass('slds-drop-zone_drag');
            return false;
          });

        },
        */

        onMove: function (evt) {
          /*
          $(".list").removeClass('hover');
          $(evt.to).addClass('hover');
          */
          $('#dropzone1').removeClass('slds-drop-zone');
          $('#dropzone1').removeClass('slds-drop-zone_drag');

          $('#dropzone1').hover(
            function() {
             //$(this).addClass('hover');
             console.log('mouseenter !');
           },
           function() {
             //$(this).removeClass('hover');
             $('#dropzone1').addClass('slds-drop-zone');
             $('#dropzone1').addClass('slds-drop-zone_drag');
              console.log('mouseleave !');
           }
          );
        },


        onEnd: function (evt){
          console.log('toolsb finished');
          console.log('toolsb old index is: '+evt.oldIndex)
          console.log('toolsb new index is: '+evt.newIndex)

          $('#listEditor').hover(function(){
            $('#dropzone1').removeClass('slds-drop-zone');
            $('#dropzone1').removeClass('slds-drop-zone_drag');
            return false;
          });

          $('.js-component-palette-button').removeClass('is-active');
          $('#component-palette-menu').addClass('slds-hide');
        }

    });

    Sortable.create(listEditor, {
        group: "shared",
        sort: true,
        onAdd: function(evt) {
          placeholder = evt.item;
          placeholder.id = 'component-' + countess;
          placeholder_id = 'component-' + countess;
          //now change display
          $('#' + placeholder_id + ' .tool').addClass('slds-hide');
          $('#' + placeholder_id + ' .placeholder').removeClass('slds-hide');

          //now clone element to right side
          var itm = document.querySelector('#component-' + countess);
          var nav = itm.cloneNode(true);
          nav.id = 'navigator-' + countess;
          var nav_id = 'navigator-' + countess;

          document.querySelector('#navigator_list').appendChild(nav);

          console.log('finished');
          console.log('placed on index is: '+evt.newIndex)



          savingAnimation();

          /*
          document.getElementById(nav_id).querySelector('.tool').className.replace('slds-hide', '');
          document.getElementById(nav_id).querySelector('.navigator').className.replace('slds-hide', '');
          */
          $('#' + nav_id + ' .tool').addClass('slds-hide');
          $('#' + nav_id + ' .placeholder').addClass('slds-hide');
          $('#' + nav_id + ' .navigator').removeClass('slds-hide');

          //show banner
          var component_type = 'banner';
          var activeComponent = 'component-' + countess;
          $('#panel_editor .component_properties').addClass('slds-hide');
          $('#editor_' + component_type).removeClass('slds-hide');
          $('#editor_' + component_type).addClass('slds-show');
          $('#string_editor').html('Banner');


          //activate tab general
          $('#editor_' + component_type + ' .tab_general').addClass('slds-active');
          $('#editor_' + component_type + ' .tab_rules').removeClass('slds-active');

          $('#editor_' + component_type + ' .tab_general_content').addClass('slds-show');
          $('#editor_' + component_type + ' .tab_general_content').removeClass('slds-hide');

          $('#editor_' + component_type + ' .tab_rules_content').removeClass('slds-show');
          $('#editor_' + component_type + ' .tab_rules_content').addClass('slds-hide');

          $('.text-activeComponent').val(activeComponent);
          $('.text-componentType').val(component_type);

          $('#panel_editor').removeClass('slds-hide');


          //START ALL UI PROCESSES

          //SAVING ANIMATION
          function savingAnimation() {
              $('#status_txt').css('opacity', '1');
              $('#status_txt').delay(500).fadeOut(1000, function() {
                  $('#status_txt').text('Saving ...');
              }).fadeIn(1000).delay(500).fadeOut(1000, function() {
                  $('#status_txt').text('Saved');
              }).fadeIn(1000);
              $('#status_txt').css('opacity', '0.5');
          }



          //HOVER NAV ITEM AND HIGHLIGHT
          $('.navigator').mouseenter(function() {
            //on hover show the sub menu and change the background color
            $(this).closest('.list-group-item').removeClass('nav');
            $(this).closest('list-group-item').addClass('nav-hover');

            //now get the id and then highlight the related component
            var get_id = $(this).closest('.list-group-item').attr('id');
            var listitem = get_id.split('navigator-');
            var highlight_item = listitem[1];
            /*
            $('#component-' + highlight_item).removeClass('nav');
            $('#component-' + highlight_item).addClass('nav-hover');
            */
            $('#component-' + highlight_item + ' .slds-drop-zone__container').addClass('slds-is-hovered');
            return false;
          });

          $('.navigator').mouseout(function() {
              //on hover show the sub menu and change the background color
              $(this).closest('.list-group-item').addClass('nav');
              $(this).closest('.list-group-item').removeClass('nav-hover');
              $('.slds-drop-zone__container').removeClass('slds-is-hovered');
          });


          //HOVER COMPONETN PLACEHOLDER AND HIGHLIGHT
          $('.list-group-item .slds-drop-zone').mouseenter(function() {
              var get_id = $(this).closest('.list-group-item').attr('id');
              var listitem = get_id.split('component-');
              var highlight_item = listitem[1];
              $('#navigator-' + highlight_item).removeClass('nav');
              $('#navigator-' + highlight_item).addClass('nav-hover');
          });
          $('.list-group-item .slds-drop-zone').mouseout(function() {
              var get_id = $(this).closest('.list-group-item').attr('id');
              var listitem = get_id.split('component-');
              var highlight_item = listitem[1];
              $('#navigator-' + highlight_item).removeClass('nav-hover');
              $('#navigator-' + highlight_item).addClass('nav');
          });



          //SHOW PROPERTIES NON MODAL
          function showProperties(component_type, activeComponent) {

              //console.log('called editor and now the activeComponent is: ' + activeComponent);
              //console.log('called editor and now the component_type is: ' + component_type);

              $('#panel_editor .component_properties').addClass('slds-hide');
              $('#editor_' + component_type).removeClass('slds-hide');
              $('#editor_' + component_type).addClass('slds-show');

              //activate tab general
              $('#editor_' + component_type + ' .tab_general').addClass('slds-active');
              $('#editor_' + component_type + ' .tab_rules').removeClass('slds-active');

              $('#editor_' + component_type + ' .tab_general_content').addClass('slds-show');
              $('#editor_' + component_type + ' .tab_general_content').removeClass('slds-hide');

              $('#editor_' + component_type + ' .tab_rules_content').removeClass('slds-show');
              $('#editor_' + component_type + ' .tab_rules_content').addClass('slds-hide');

              $('.text-activeComponent').val(activeComponent);
              $('.text-componentType').val(component_type);

              $('#panel_editor').removeClass('slds-hide');
          }


          //DELETE COMPONENT
          $('.js-trigger-delete-component, .action-delete-component').click(function() {

              var get_case = $(this).closest('.list-group-item').attr('id');
              //console.log('call delete:' +listitem);

              /*
              $('#' + activeComponentPlaceholder).remove();
              $('#' + activeNavigationPlaceholder).remove();

              $('#modal-id-4-delete').addClass('slds-hide');
              activeComponentPlaceholder = undefined;
              activeNavigationPlaceholder = undefined;


              if ($('#canvas_list > li.draggable').length != 0) {} else {
                  $('.component_properties').addClass('slds-hide');
                  $('.component_properties .placeholder').toggleClass('slds-hide');
              }
              */
              return false;
          });


          //BANNER HANDLING
          $('.button-trigger-action--edit-component-banner').click(function() {
              var component_type = 'banner';
              $('#string_editor').html('Banner');
              $('.slds-drop-zone__container').removeClass('slds-is-hovered');
              $(this).closest('.slds-drop-zone__container').toggleClass('slds-is-hovered');
              var activeComponent = $(this).closest('.list-group-item').attr('id');
              var str = $(this).closest('.list-group-item').attr('id');
              var editstring = str.split('component-');
              var editit = editstring[1];
              //console.log('check for editing: ' + editit);
              var banner_value = $('#component-' + editit + ' .image-holder').attr('src');
              //console.log('image ist: ' + banner_value);
              if (typeof banner_value === 'undefined') {
                  $('.image-figure-thumb').attr('src', '/assets/placeholder.png');
                  $('.file-name').text('Please select an image');
              } else {
                  $('.image-figure-thumb').attr('src', '' + banner_value + '');
                  $('.file-name').text(banner_value);
              }
              var header1_value = $('#component-' + editit + ' .banner-header').html();
              //console.log('header 1 ist: ' + header1_value);
              $('input.text-banner-header').val(header1_value);

              var header2_value = $('#component-' + editit + ' .banner-sub').html();
              //console.log('header 2 ist: ' + header2_value);
              $('input.text-banner-sub').val(header2_value);
              $('#panel_editor .slds-panel').removeClass('slds-size_x-large');
              $('#panel_editor .slds-panel').addClass('slds-size_medium');
              showProperties(component_type, activeComponent);
          });


          //TRIGGER COMPONENT DELETION
          $('.button-trigger-action--delete-component').click(function() {
              var get_case = $(this).closest('.list-group-item').attr('id');
              var listitem = get_case.split('component-');
              //console.log('call delete'+listitem);
              $('#listitem').val(listitem[1]);
              $('#modal-id-4-delete').removeClass('slds-hide');
              return false;
          });


          $('.trash').click(function() {
              var get_case = $(this).closest('.list-group-item').attr('id');
              var listitem = get_case.split('navigator-');
              //console.log('call delete'+listitem);
              $('#listitem').val(listitem[1]);
              $('#modal-id-4-delete').removeClass('slds-hide');
              return false;
          });


          //DELETE COMPONENT
          $('.js-trigger-delete-component, .action-delete-component').click(function(listitem) {
              var deleteitem = $('#listitem').val();
              //console.log('now delete: '+deleteitem);
              $('#navigator-'+deleteitem).fadeOut(500,function(){$(this).remove();});
              $('#component-'+deleteitem).fadeOut(500,function(){$(this).remove();});

              $('#listitem').val('');
              $('#panel_editor').addClass('slds-hide');
              $('#modal-id-4-delete').addClass('slds-hide');

              savingAnimation();

              return false;
          });







          //now count up
          countess++
        },
    });
        /*
        document.getElementsByClassName('hoverme').onclick = function() {
          //_this.innerFunction();
          alert('clicked');
        }
        */




</script>
