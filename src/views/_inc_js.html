<script>
$(document).ready(function() {
  //DRAG DROP MOVE AROUND
  count = 0;

  $('.draggable').draggable({
      connectToSortable:'.list',
      helper: 'clone',
      //handle: '.handle',
      start: function(event, ui) {
          //var txt = ui.helper.children('a').text());
          var txt = $(ui.helper.children('a')).text();

          console.log('start dragging');
          console.log(txt);
      },
      stop: function(event, ui) {
          var txt = $(ui.helper.children('a')).text();

          console.log('stop dragging: '+txt);
          console.log('saving...');
          savingAnimation();


          ui.helper.children('.add-component').remove();
          ui.helper.children('div.component').removeClass('slds-hide').hide().fadeIn('slow');

          //add id to placeholder
          $(this).addClass('ui-draggable-dragged');
          ui.helper.attr('id','component_placeholder_'+count);

          //add navigator item
          var nav_item = '<li class="slds-item" id="navigator_placeholder_'+count+'"><span class="slds-tree__item-label slds-truncate" title="'+txt+'">'+txt+'</span</li>';
          $(nav_item).attr('id','navigator_placeholder_'+count);
          $('#navigator_list').append(nav_item);


          count++;

          $('.list button.button-trigger-action--edit-component-row').click(function() {
            var component_type = 'row';
            $('.draggable .slds-drop-zone__container').removeClass('slds-is-hovered');
            $(this).closest('.draggable .slds-drop-zone__container').toggleClass('slds-is-hovered');
            console.log('clicked edit');
            showProperties(component_type);
          });


          $('.list button.button-trigger-action--edit-component-banner').click(function() {
            var component_type = 'banner';
            $('.draggable .slds-drop-zone__container').removeClass('slds-is-hovered');
            $(this).closest('.draggable .slds-drop-zone__container').toggleClass('slds-is-hovered');
            console.log('clicked edit' +component_type);
            showProperties(component_type);
          });

          $('.list button.button-trigger-action--edit-component-category').click(function() {
            var component_type = 'category';
            $('.draggable .slds-drop-zone__container').removeClass('slds-is-hovered');
            $(this).closest('.draggable .slds-drop-zone__container').toggleClass('slds-is-hovered');
            console.log('clicked edit');
            showProperties(component_type);
          });



          $('.list button.button-trigger-action--delete-component').click(function() {
            console.log('clicked delete component placeholder and nav');

            var activeComponentPlaceholder = undefined;
            var activeNavigationPlaceholder = undefined;

            var activeComponentPlaceholder = $(this).closest('li').attr('id');
            if(activeComponentPlaceholder.match('component_placeholder_')) {
              arr = activeComponentPlaceholder.split('component_');
              var activeNavigationPlaceholder = 'navigator_'+arr[1];
              console.log(activeNavigationPlaceholder);
              arr = undefined;
            }
            $('#modal-id-4-delete').removeClass('slds-hide');
            console.log('open delete modal');
            //DELETE ANY COMPONENT
            $('.js-trigger-delete-component, .action-delete-component').click(function() {
                console.log('close delete modal');
                $('#'+activeComponentPlaceholder).remove();
                $('#'+activeNavigationPlaceholder).remove();

                $('#modal-id-4-delete').addClass('slds-hide');
                activeComponentPlaceholder = undefined;
                activeNavigationPlaceholder = undefined;
                console.log('saving...');

                if ($('#canvas_list > li.draggable').length != 0){
                  console.log('still editors in canvas');
                }else{
                  console.log('no more editors in canvas');
                  $('.component_properties').addClass('slds-hide');
                  $('.component_properties .placeholder').toggleClass('slds-hide');
                }
                return false;
            });
          });

          /*
          $('.list button.button-trigger-action--move-component').click(function() {
            console.log('clicked move');
          });
          */

      }
  });


  $('.list').sortable({
  	revert: true,
    start:  function(event, ui){
      ui.helper.css('width','auto');
      ui.helper.css('height','auto');
      $('ul,li').disableSelection();
    }
  });


//SAVING ANIMATION
function savingAnimation() {
  $('#status_txt').delay(500).fadeOut(1000,function(){
    $('#status_txt').text('Saving ...');
  }).fadeIn(1000).delay(500).fadeOut(1000,function(){
    $('#status_txt').text('Saved');
  }).fadeIn(1000);
}



//NAVIGATOR
function showNavigation() {
  /*
  $('#tab-navigator').removeClass('slds-hide');
  $('#tab_navigator').addClass('slds-show');
  $('#tab-properties').addClass('slds-hide');
  $('#tab_properties').removeClass('slds-show');

  $('#tab_prop').removeClass('slds-active');
  $('#tab_prop').removeClass('slds-is-active');
  $('#tab_nav').addClass('slds-active');
  $('#tab_nav').addClass('slds-is-active');
  */
}
//showNavigation();

function showProperties(component_type) {
  $('#panel_editor .component_properties').addClass('slds-hide');

  console.log('calling now component properties: '+component_type);

  $('#editor_'+component_type).removeClass('slds-hide');
  $('#editor_'+component_type).addClass('slds-show');
  $('#panel_editor').removeClass('slds-hide');
}

//MEDIA SELECTOR
$('#panel_right .slds-panel__close').click(function() {
  $('#panel_right').addClass('slds-hide');
  return false;
});







//GALLERY BROWSING
$('.select_collectionA').click(function() {
  alert();
  console.log('open collection A');
  $('.select_collectionA').addClass('slds-is-selected');
  $('.collectionA').removeClass('slds-hide');

  $('.select_collectionB').removeClass('slds-is-selected');
  $('.collectionB').addClass('slds-hide');

  $('.select_collectionC').removeClass('slds-is-selected');
  $('.collectionC').addClass('slds-hide');

  $('.select_collectionD').removeClass('slds-is-selected');
  $('.collectionD').addClass('slds-hide');

  $('.select_collectionG').removeClass('slds-is-selected');
  $('.collectionG').addClass('slds-hide');
    return false;
});


$('.select_collectionB').click(function() {
  console.log('open collection B');
  $('.select_collectionB').addClass('slds-is-selected');
  $('.collectionB').removeClass('slds-hide');

  $('.select_collectionA').removeClass('slds-is-selected');
  $('.collectionA').addClass('slds-hide');

  $('.select_collectionC').removeClass('slds-is-selected');
  $('.collectionC').addClass('slds-hide');

  $('.select_collectionD').removeClass('slds-is-selected');
  $('.collectionD').addClass('slds-hide');

  $('.select_collectionG').removeClass('slds-is-selected');
  $('.collectionG').addClass('slds-hide');
    return false;
});


$('.select_collectionC').click(function() {
  console.log('open collection C');
  $('.select_collectionC').addClass('slds-is-selected');
  $('.collectionC').removeClass('slds-hide');

  $('.select_collectionB').removeClass('slds-is-selected');
  $('.collectionB').addClass('slds-hide');

  $('.select_collectionA').removeClass('slds-is-selected');
  $('.collectionA').addClass('slds-hide');

  $('.select_collectionD').removeClass('slds-is-selected');
  $('.collectionD').addClass('slds-hide');

  $('.select_collectionG').removeClass('slds-is-selected');
  $('.collectionG').addClass('slds-hide');
    return false;
});

$('.select_collectionD').click(function() {
  $('.select_collectionD').addClass('slds-is-selected');
  $('.collectionD').removeClass('slds-hide');

  $('.select_collectionB').removeClass('slds-is-selected');
  $('.collectionB').addClass('slds-hide');

  $('.select_collectionA').removeClass('slds-is-selected');
  $('.collectionA').addClass('slds-hide');

  $('.select_collectionC').removeClass('slds-is-selected');
  $('.collectionC').addClass('slds-hide');

  $('.select_collectionG').removeClass('slds-is-selected');
  $('.collectionG').addClass('slds-hide');
    return false;
});


$('.select_collectionG').click(function() {
  $('.select_collectionG').addClass('slds-is-selected');
  $('.collectionG').removeClass('slds-hide');

  $('.select_collectionB').removeClass('slds-is-selected');
  $('.collectionB').addClass('slds-hide');

  $('.select_collectionA').removeClass('slds-is-selected');
  $('.collectionA').addClass('slds-hide');

  $('.select_collectionC').removeClass('slds-is-selected');
  $('.collectionC').addClass('slds-hide');

  $('.select_collectionD').removeClass('slds-is-selected');
  $('.collectionD').addClass('slds-hide');
    return false;
});










//MEDIA SELECTOR
$('.add-mediaselector-dummy').click(function() {
    selected_image = undefined;
    $('.mediaselector-component-editor .image-figure-thumb').attr('src', '/assets/placeholder.png');
    $('.mediaselector-component-editor .file-name').html('No Image assigned');


    $('#banner-checkbox_everyone').prop('checked', false);
    $('#banner-checkbox_customergroupa').prop('checked', false);
    $('#banner-checkbox_customergroupb').prop('checked', false);

    //now open editor
    activeComponent = undefined;
    activeComponent = $(component_placeholder).attr('id');

    //add 1 to component count
    regionlimit = $('#'+closest_region+'_links .region_limit').text();
    regionlimit = Number(regionlimit) + 1;

    $('#'+closest_region+'_links .region_limit').text('');
    $('#'+closest_region+'_links .region_limit').text(regionlimit);

    $('.region_component_selector').toggleClass('slds-hide');
    $('.mediaselector-component-editor').toggleClass('slds-hide');

    $('.modal-content-id-37 .tab_general').addClass('slds-active');
    return false;
});

//BANNER COMPONENT
$('.mediaselector-component-editor .image-figure, .add-image').click(function() {
    callerComponent = 'banner';
    /*
    $('.media-picker').toggleClass('slds-hide');
    $('.mediaselector-component-editor').toggleClass('slds-hide');
    $('.product-component-editor').addClass('slds-hide');
    */
    $('.media-picker').toggleClass('slds-hide');
    console.log('call image add');
});

$('.media-component button.js-trigger-edit-component').click(function() {
    activeComponent = undefined;
    activeComponent = $(this).closest('li').attr('id');

    $('#banner-checkbox_everyone').prop('checked', false);
    $('#banner-checkbox_customergroupa').prop('checked', false);
    $('#banner-checkbox_customergroupb').prop('checked', false);


    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
      $('#banner-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
      $('#banner-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
      $('#banner-checkbox_customergroupb').prop('checked', true);
    }


    return false;
});


$('.media-component-editor button.trigger-save-modal').click(function() {
    selected_text = $('.slds-rich-text-area__content').html();
    selected_header = $('.slds-input-header').val();
    $('#'+ activeComponent + ' .text-holder').html(selected_text);
    $('#'+ activeComponent + ' .header-holder').html(selected_header);

    return false;
});

//IMAGE SELECT
$('.image-thumb').click(function() {
    //selected_image = $(this).find('h2').text();
    selected_image = $(this).closest('a').find('img').attr('src');
    $('.slds-file_card').removeClass('selected');
    $(this).closest('.slds-file_card').addClass('selected');
    return false;
});

//IMAGE SAVE
$('.picker .trigger-save-modal').click(function() {
    if(callerComponent == 'banner'){
      console.log('selected image: '+selected_image);
      $('#editor_banner .image-figure-thumb').attr('src', selected_image);
      $('#editor_banner .file-name').text(selected_image);
      $('.picker').addClass('slds-hide');
      $('.circle').toggleClass('slds-hide');
      //$('.mediaselector-component-editor').toggleClass('slds-hide');
    }else{
      $('#editor_banner .image-figure-thumb').attr('src', selected_image);
      $('#editor_banner .file-name').text(selected_image);
      $('.picker').addClass('slds-hide');
      $('.circle').toggleClass('slds-hide');
      $('.product-component-editor').toggleClass('slds-hide');

    }
});

//NOW CLOSE PICKER AND SET IMAGE
$('.mediaselector-component-editor .trigger-save-modal').click(function() {
    $('.mediaselector-component-editor').toggleClass('slds-hide');
    $('#'+ activeComponent + ' .image-holder').css('background-image', 'url(' + selected_image + ')');
    $('#'+ activeComponent + ' .image-holder span.no-image').addClass('slds-hide');

    banner_header = undefined;
    banner_sub = undefined;
    banner_header = $('.text-banner-header').val();
    banner_sub = $('.text-banner-sub').val();

    $('#'+ activeComponent + ' .banner-header').html(banner_header);
    $('#'+ activeComponent + ' .banner-sub').html(banner_sub);

    $('.text-banner-header').val('');
    $('.text-banner-sub').val('');
});


//BANNER COMPONENT EDIT
$('.placeholder-component-37 .js-trigger-edit-component, .js-trigger-media-edit-component').click(function() {
    activeComponent = undefined;
    activeComponent = $(this).closest('li').attr('id');

    $('#banner-checkbox_everyone').prop('checked', false);
    $('#banner-checkbox_customergroupa').prop('checked', false);
    $('#banner-checkbox_customergroupb').prop('checked', false);


    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
        $('#banner-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
        $('#banner-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
        $('#banner-checkbox_customergroupb').prop('checked', true);
    }



    //GET IMAGE
    //imgUrl = $(this).closest('.placeholder').find('.image-holder').css('background-image');
    imgUrl = $('#'+activeComponent).find('.image-holder').css('background-image');

    patt=/\"|\'|\)/g;
    selected_image = '/assets/'+imgUrl.split('/').pop().replace(patt,'');

    //GET TEXTS
    banner_header = $('#' + activeComponent).find('.title').text();
    banner_sub =    $('#' + activeComponent).find('.sub').text();

    $('.mediaselector-component-editor .image-figure-thumb').attr('src', selected_image);

    //SET TAB
    $('.modal-content-id-37 .tab_general').addClass('slds-active');
    $('.mediaselector-component-editor .text-banner-header').val(banner_header);
    $('.mediaselector-component-editor .text-banner-sub').val(banner_sub);
    $('.mediaselector-component-editor').toggleClass('slds-hide');
});



$('.js-trigger-media-edit-rules').click(function() {
    activeComponent = undefined;
    activeComponent = $(this).closest('li').attr('id');

    if(activeComponent.match('_links')) {
      arr = activeComponent.split('_');
      activeComponent = arr[0];
      arr = undefined;
    }

    $('#banner-checkbox_everyone').prop('checked', false);
    $('#banner-checkbox_customergroupa').prop('checked', false);
    $('#banner-checkbox_customergroupb').prop('checked', false);


    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
        $('#banner-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
      $('#banner-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
      $('#banner-checkbox_customergroupb').prop('checked', true);
    }



    //GET IMAGE
    //imgUrl = $(this).closest('.placeholder').find('.image-holder').css('background-image');
    imgUrl = $('#'+activeComponent).find('.image-holder').css('background-image');

    patt=/\"|\'|\)/g;
    selected_image = '/assets/'+imgUrl.split('/').pop().replace(patt,'');

    //GET TEXTS
    banner_header = $('#'+ activeComponent).find('.title').text();
    banner_sub =    $('#'+ activeComponent).find('.sub').text();

    $('.mediaselector-component-editor .image-figure-thumb').attr('src', selected_image);

    //SET TAB
    $('.modal-content-id-37 .tab_rules').addClass('slds-active');
    $('.mediaselector-component-editor .text-banner-header').val(banner_header);
    $('.mediaselector-component-editor .text-banner-sub').val(banner_sub);
    $('.mediaselector-component-editor').toggleClass('slds-hide');

    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
      $('#banner-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
      $('#banner-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
      $('#banner-checkbox_customergroupb').prop('checked', true);
    }


});











//MODAL HANDLERS
$('.trigger-close-modal').click(function() {
    $(this).closest('.modal').toggleClass('slds-hide');
    return false;
});


//SIDE PANEL COLLAPSE EXPAND
$('#panel_left .slds-panel__close').click(function() {
  $('#panel_left').removeClass('left_expanded');
  $('#panel_left').addClass('left_collapsed');
  $('#panel_left .slds-dropdown__header').addClass('slds-hide');
  $('#button_left_expand').toggleClass('slds-hide');
  return false;
});

$('#button_left_expand').click(function() {
  $('#panel_left').removeClass('left_collapsed');
  $('#panel_left').addClass('left_expanded');
  $('#panel_left .slds-dropdown__header').removeClass('slds-hide');
  $('#button_left_expand').toggleClass('slds-hide');
  return false;
});











/*
  $('#component_list .draggable').draggable({
      connectToSortable: '.list',
      helper: 'clone',
      start: function(event, ui){
        //ui.helper.children('a').remove();
        console.log('start dragging');
      }
      start: function(event, ui){
        //ui.helper.children('a').remove();
        console.log('stop dragging');
      }
  });

  $('.list').droppable({
    drop: function(event, ui){
      ui.helper.children('.add-component').remove();
      ui.helper.css('width','auto');
      ui.helper.css('height','auto');
      //ui.helper.children('div.component').removeClass('slds-hide');
      ui.helper.children('div.component').removeClass('slds-hide').hide().fadeIn('slow');
    }
  });

  $('.list').sortable({
  	revert: true,
    start:  function(event, ui){
      ui.helper.css('width','auto');
      ui.helper.css('height','auto');
      $('ul,li').disableSelection();
    }
  });

  //DELETE Component
  $('button').click(function() {
      alert('called: .button-trigger-action--move-component');
      console.log('button clicked');
  });


  */

/*
var clone, before, parent
$('#canvas_list').sortable({
    connectWith: '#compo_list',
    helper: 'clone',
    start: function (event, ui) {
        $(ui.item).show();
        clone = $(ui.item).clone();
        before = $(ui.item).prev();
        parent = $(ui.item).parent();

    },
    receive: function (event, ui) { //only when dropped from one to another!
        if (before.length) before.after(clone);
        else parent.prepend(clone);
    }
}).disableSelection();
*/

//$('.draggable').draggable();

/*

*/
//$('ul,li').disableSelection();



//DELETE Component
/*
$('button').click(function() {
    alert('called: .button-trigger-action--move-component');
    //console.log('button clicked');
    //$(this).closest('.layout_rows').css('background','red');
});
*/






/*
//DUMMY PAGE FUNCTIONALITY
var closest_region = undefined;
var region_container = undefined;

var edit_the_row = 'no';


var activeComponent = undefined;
var activePickerbase = undefined;

var cloneCountA = 0;
var cloneCountB = 0;

var longtext = undefined;
var selected_image = undefined;
var selected_video = undefined;
var selected_text = undefined;
var selected_header = undefined;
var selected_sub_header = undefined;

var selected_product_name = undefined;
var selected_product_brand = undefined;
var selected_product_price = undefined;
var selected_product_id = undefined;
var selected_product_image = undefined;

var checked_cat = undefined;


var seomax_a = 160;
var seomax_b = 70;


var $win = $(window); // or $box parent container
var $box = $('#component-selecta');
var $boxb = $('#language-selecta');
var $boxc = $('#device-selecta');
var $boxd = $('.sub-left').closest('.slds-dropdown-trigger');
var $boxe = $('.sub-right .slds-dropdown-trigger');

var show_recommendation = false;

//var $box = $('.slds-dropdown-trigger');
var copytext = undefined;


//counter for components
var max_regionlimit = '/1';
var regionlimit = 0;
$('.region_limit').text(regionlimit);
$('.max_region_limit').text(max_regionlimit);


var selectedCG = new Array();

var selected_layout = 1;


//TOP TOOLBAR
 $('#language-selecta').click(function(){
     $('#language-selecta').next('.slds-dropdown-trigger--click').toggleClass('slds-is-open');
 });






//HIDE ALL MENUS
$(function() {
    $win.on('click.Bst', function(event) {
        //MAIN COMPONENT SELECT
        if (
            $box.has(event.target).length == 0 //checks if descendants of $box was clicked
            &&
            !$box.is(event.target) //checks if the $box itself was clicked
            &&
            $($box).hasClass('slds-is-open')
        ) {
            $($box).toggleClass('slds-is-open')
        }
        //LOCALIZATION SELECT
        if (
            $boxb.has(event.target).length == 0 //checks if descendants of $box was clicked
            &&
            !$boxb.is(event.target) //checks if the $box itself was clicked
            &&
            $($boxb).hasClass('slds-is-open')
        ) {
            $($boxb).toggleClass('slds-is-open')
        }
        //DEVICE SELECT
        if (
            $boxc.has(event.target).length == 0 //checks if descendants of $box was clicked
            &&
            !$boxc.is(event.target) //checks if the $box itself was clicked
            &&
            $($boxc).hasClass('slds-is-open')
        ) {
            $($boxc).toggleClass('slds-is-open')
        }
        //SUB LEFT SELECT
        if (
            $boxd.has(event.target).length == 0 //checks if descendants of $box was clicked
            &&
            !$boxd.is(event.target) //checks if the $box itself was clicked
            &&
            $($boxd).hasClass('slds-is-open')
        ) {
            $($boxd).toggleClass('slds-is-open')
        }
        //SUB RIGHT SELECT
        if (
            $boxe.has(event.target).length == 0 //checks if descendants of $box was clicked
            &&
            !$boxe.is(event.target) //checks if the $box itself was clicked
            &&
            $($boxe).hasClass('slds-is-open')
        ) {
            $($boxe).toggleClass('slds-is-open')
        }


    });

    return false;
});



//COUNT SEO CHARS

$('#spn-id-seo_description').html(seomax_a + '  Remaining');
$('#textarea-id-seo_description').keyup(function() {
    var lenght1 = $('#textarea-id-seo_description').val().length;
    var remaining = seomax_a - lenght1;
    $('#spn-id-seo_description').html(remaining + '  Remaining');
    if (remaining < 0) {
        $('#spn-id-seo_description').css('opacity', '0.4').css('color', 'red');
    } else {
        $('#spn-id-seo_description').css('opacity', '1').css('color', 'black');
    }
    if (remaining < 10) {
        $('#spn-id-seo_description').addClass('slds-destructive');
    } else {
        $('#spn-id-seo_description').removeClass('slds-destructive');
    }

});
$('#spn-id-seo_title').html(seomax_b + '  Remaining');
$('#input-seo_title').keyup(function() {
    var lenght2 = $('#input-seo_title').val().length;
    var remaining_b = seomax_b - lenght2;
    $('#spn-id-seo_title').html(remaining_b + '  Remaining');
    if (remaining_b < 0) {
        $('#spn-id-seo_title').css('opacity', '0.4').css('color', 'red');
    } else {
        $('#spn-id-seo_title').css('opacity', '1').css('color', 'black');
    }
    if (remaining_b < 10) {
        $('#spn-id-seo_title').css('color', 'red');
    } else {
        $('#spn-id-seo_title').css('color', 'black');
    }

});


//CREATE PAGE TOAST
$('button.close-toast-2').click(function() {
    $('#created-toast').toggleClass('slds-hide');
});

//BACK TO LIST
$('#back-to-list').click(function() {
    location.href = 'page-list.html';
});


//SCREEN SIZES
$('#trigger-phone').click(function() {
    $('#device-selecta li').removeClass('slds-is-selected');
    $(this).closest('li').addClass('slds-is-selected');

    $('.page-content').css('max-width', '320px');
    $('#tools .slds-dropdown-trigger').toggleClass('slds-is-open');

});
$('#trigger-tablet').click(function() {
    $('#device-selecta li').removeClass('slds-is-selected');
    $(this).closest('li').addClass('slds-is-selected');

    $('.page-content').css('max-width', '800px');
    $('#tools .slds-dropdown-trigger').toggleClass('slds-is-open');
});
$('#trigger-desktop').click(function() {
    $('#device-selecta li').removeClass('slds-is-selected');
    $(this).closest('li').addClass('slds-is-selected');

    $('.page-content').css('max-width', '100%');
    $('#tools .slds-dropdown-trigger').toggleClass('slds-is-open');
});


//LOCALES
$('#trigger-us').click(function() {
    $('#language-selecta li').removeClass('slds-is-selected');
    $('.lang-fra').removeClass('slds-is-selected');
    $('.lang-de').removeClass('slds-is-selected');
    $(this).closest('li').addClass('slds-is-selected');
    $('.language-menu').removeClass('slds-is-open');
});
$('#trigger-fr').click(function() {
    $('#language-selecta li').removeClass('slds-is-selected');
    $('.lang-us').removeClass('slds-is-selected');
    $('.lang-de').removeClass('slds-is-selected');
    $(this).closest('li').addClass('slds-is-selected');
    //$('#locale-warning').toggleClass('slds-hide');
    $('.language-menu').removeClass('slds-is-open');

});
$('#trigger-de').click(function() {
    $('#language-selecta li').removeClass('slds-is-selected');
    $('.lang-us').removeClass('slds-is-selected');
    $('.lang-fra').removeClass('slds-is-selected');
    $(this).closest('li').addClass('slds-is-selected');
    $('.language-menu').removeClass('slds-is-open');
});








//FILTER VIEW
$('#trigger_preview').click(function() {
    $('#poppinD').toggleClass('slds-hide');
});
$('.js-close-filter-view').click(function() {
    $('#poppinD').toggleClass('slds-hide');
});

$('#poppinD button').click(function() {
    $('#poppinD').toggleClass('slds-hide');
});


//PREVIEW
$('#trigger-preview').click(function() {
    $('.page-bottom-section').fadeTo('slow',1);
    $('.page-header-section').fadeTo('slow',1);
    $('.slds-button-container').toggleClass('slds-hide');
    $('.slds-button--icon-more').toggleClass('slds-hide');
    $('.region').toggleClass('region region-off');
    $('#editor').toggleClass('editor-off');
    $('#trigger-back-to-edit').toggleClass('slds-hide');
    $('#trigger-preview').toggleClass('slds-hide');
    $('#tools').toggleClass('slds-hide');
    $('.mini-menu').toggleClass('slds-hide');
    $('.sub-mini-menu').toggleClass('slds-hide');
    $('.placeholder').toggleClass('placeholder placeholder-off');
    $('#trigger-publish').toggleClass('slds-hide');
    $('#sidebar-navigator').fadeOut('slow');
    $('.placeholder-component-38 .sub-mini-menu').addClass('slds-hide');
});

$('#trigger-published-preview').click(function() {
    $('.page-bottom-section').fadeTo('slow',1);
    $('.page-header-section').fadeTo('slow',1);

    $('.slds-button-container').toggleClass('slds-hide');
    $('.slds-button--icon-more').toggleClass('slds-hide');
    $('.region').toggleClass('region region-off');
    $('#editor').toggleClass('editor-off');
    $('#trigger-back-to-edit').toggleClass('slds-hide');
    $('#trigger-preview').toggleClass('slds-hide');
    $('#tools').toggleClass('slds-hide');
    $('.mini-menu').toggleClass('slds-hide');
    $('.sub-mini-menu').toggleClass('slds-hide');
    $('.placeholder').toggleClass('placeholder placeholder-off');
    $('#trigger-publish').toggleClass('slds-hide');
    $('#sidebar-navigator').fadeOut('slow');
    $('.placeholder-component-38 .sub-mini-menu').addClass('slds-hide');
});

$('#trigger-back-to-edit').click(function() {
    $('.page-bottom-section').fadeTo('slow',0.2);
    $('.page-header-section').fadeTo('slow',0.2);

    $('.slds-button-container').toggleClass('slds-hide');
    $('.slds-button--icon-more').toggleClass('slds-hide');
    $('.region-off').toggleClass('region-off region');
    $('.editor-off').toggleClass('editor-off editor');
    $('#trigger-back-to-edit').toggleClass('slds-hide');
    $('#trigger-preview').toggleClass('slds-hide');
    $('#tools').toggleClass('slds-hide');
    $('.mini-menu').toggleClass('slds-hide');
    $('.sub-mini-menu').toggleClass('slds-hide');
    $('.placeholder-off').toggleClass('placeholder-off placeholder');
    $('#trigger-publish').toggleClass('slds-hide');
    $('#sidebar-navigator').fadeIn('slow');
    $('.placeholder-component-38 .sub-mini-menu').addClass('slds-hide');
});


//PUBLISH
$('#trigger-publish').click(function() {
    $('.modal-id-101').toggleClass('slds-hide');
});
$('.modal-id-101 .trigger-close').click(function() {
    $('.modal-id-101').toggleClass('slds-hide');
});
$('.modal-id-101 .trigger-cancel').click(function() {
    $('.modal-id-101').toggleClass('slds-hide');
});
$('.modal-id-101 .trigger-publish').click(function() {
    $('.modal-id-101').toggleClass('slds-hide');
    $('#toast-page-published').toggleClass('slds-hide');
    $('#trigger-publish').toggleClass('slds-hide');
    $('#trigger-preview').toggleClass('slds-hide');
    $('#trigger-published-preview').toggleClass('slds-hide');
    $('#trigger-published').toggleClass('slds-hide');
    $('#not_published').toggleClass('slds-hide');
    $('#page_published').toggleClass('slds-hide');
    $('#badge-offline').toggleClass('slds-hide');
    $('#badge-online').toggleClass('slds-hide');
});
$('#toast-page-published .close-toast-2').click(function() {
    $('#toast-page-published').toggleClass('slds-hide');
});


//UNPUBLISH
$('#trigger-published').click(function() {
    $('.modal-id-unpublish').toggleClass('slds-hide');
});
$('.modal-id-unpublish #trigger-close').click(function() {
    $('#modal-id-unpublish').toggleClass('slds-hide');
});
$('.modal-id-unpublish #trigger-cancel').click(function() {
    $('.modal-id-unpublish').toggleClass('slds-hide');
});
$('.modal-id-unpublish #trigger-unpublish').click(function() {
    $('.modal-id-unpublish').toggleClass('slds-hide');
    $('#toast-page-unpublished').toggleClass('slds-hide');
    $('#trigger-publish').toggleClass('slds-hide');
    $('#trigger-preview').removeClass('slds-hide');
    $('#trigger-published-preview').toggleClass('slds-hide');
    $('#trigger-published').toggleClass('slds-hide');
    $('#not_published').toggleClass('slds-hide');
    $('#page_published').toggleClass('slds-hide');
    $('#badge-offline').toggleClass('slds-hide');
    $('#badge-online').toggleClass('slds-hide');
});

$('#toast-page-unpublished .close-toast-2').click(function() {
    $('#toast-page-unpublished').toggleClass('slds-hide');
});


//TRIGGER DELETE PAGE
$('.js-open-modal-id-1').click(function() {
    $('.modal-id-1').toggleClass('slds-hide');
    $('.slds-dropdown-trigger').removeClass('slds-is-open');
    $('.slds-dropdown-trigger').addClass('slds-is-closed');
});

//DELETE PAGE MODAL
$('.modal-id-1 button.js-close-modal-id-1').click(function() {
    $('.modal-id-1').toggleClass('slds-hide');
    $('#toast-id-1').toggleClass('slds-hide');
});

//CLOSE DELETE TOAST
$('#js-close-toast-id-1').click(function() {
    $('#toast-id-1').toggleClass('slds-hide');
});

//TRIGGER NEW PAGE
$('#js-open-modal-id-2').click(function() {
    $('.modal-id-2').toggleClass('slds-hide');
});


//NEW PAGE MODAL
$('.js-close-modal-id-2').click(function() {
    $('.modal-id-2').toggleClass('slds-hide');
});
$('.js-close-modal-id-100').click(function() {
    $('.modal-id-100').toggleClass('slds-hide');
});
$('#js-open-modal-100').click(function() {
    $('.modal-id-100').toggleClass('slds-hide');
});

//SIDEBAR
$('#button-page-navigator').click(function() {
    $('#sidebar-navigator').toggleClass('slds-hide');
});
$('#button-close-navigator').click(function() {
    $('#modal-page-navigator').toggleClass('slds-hide');
});
$('#button-preview-settings').click(function() {
    $('#modal-id-102').toggleClass('slds-hide');
});
$('#button-close-navigator').click(function() {
    $('#sidebar-navigator').toggleClass('slds-hide');
});


//MODAL PREVIEW SETTINGS
$('#modal-id-102 .js-close-modal-id-102').click(function() {
    $('#modal-id-102').toggleClass('slds-hide');
});


//sort at the same time navigator and component
var currentIndex;
$(function() {
    $('.list').sortable({
        start: function(event, ui) {
            currentIndex = ui.helper.index();
        },
        change: function(event, ui) {
            var indexCount = ui.item.parent().find('li:not(.ui-sortable-helper)');
            var sortClass = '.' + ui.item.attr('class').split(' ')[0];
            var parent = $('.list').not(ui.item.parent());

            if (currentIndex > ui.placeholder.index()) {
                parent.find('li').eq(indexCount.index(ui.placeholder)).before(parent.find(sortClass));
            } else
                parent.find('li').eq(indexCount.index(ui.placeholder)).after(parent.find(sortClass));
            currentIndex = ui.placeholder.index();
        }
    });
    $('.list').disableSelection();
});


//delete component and navigator item all together
$('.delete-component .js-close-modal-id-0').click(function() {
    //$(this).closest('li').find('.delete-component').toggleClass('slds-hide');
    $('.delete-component').toggleClass('slds-hide');

    return false;
});






//IMAGE SELECT
$('.image-thumb').click(function() {
    //selected_image = $(this).find('h2').text();
    selected_image = $(this).closest('a').find('img').attr('src');
    $('.slds-file_card').removeClass('selected');
    $(this).closest('.slds-file_card').addClass('selected');

    return false;
});



//HOVER LI ITEM
$('.list>li').hover(function() {
});







//LOADER PAGE LIST
$(function() {
    $('.spinner').delay(3000).fadeOut('slow');
    $('#page_list').delay(4000).fadeIn('slow');
});


//OCAPI modal__close
$('.js-close-modalA').click(function() {
    //open dialog for selecting an image
    $('#modalA').toggleClass('slds-hide');
});

$('.js-run-modalB').click(function() {
    //open dialog for selecting an image
    $('#modalB').toggleClass('slds-hide');
    //$('#modal-content-id-1B-loader').delay(6000).toggleClass('slds-hide');
    //$('#modal-content-id-1B-stuff').delay(4000).toggleClass('slds-hide');
});

$('.js-close-modalB').click(function() {
    //open dialog for selecting an image
    $('#modalB').toggleClass('slds-hide');
});


$('.action_level_1').click(function() {
    //open dialog for selecting an image
    $('#row-2').toggleClass('slds-hide');
});



$('.action_level_2').click(function() {
    //open dialog for selecting an image
    $('#row-3').toggleClass('slds-hide');
    $('#row-loader').toggleClass('slds-hide');
});


$('.js-copy-modalA').click(function() {
    //open dialog for selecting an image
    $('#textarea-body').toggleClass('slds-hide');
    $('#textarea-empty').toggleClass('slds-hide');
    $('#modalA').toggleClass('slds-hide');
});

$('#author').click(function() {
    $('#help').toggleClass('slds-hide');
});


$('#component-selecta').click(function() {
    $('.region_component_selector').toggleClass('slds-hide');
});


$('.region_component_selector .js-close-dropdown').click(function() {
    //$(this'.region_component_selector').addClass('slds-hide');
    //$(this).closest('.region_component_selector').addClass('slds-hide');
    $('.region_component_selector').toggleClass('slds-hide');
});


$('#rtf_button_link').click(function() {
    $('#link-menu').toggleClass('slds-is-open');
});



//check rules
$('.input-rules-from').blur(function() {
    if (!$(this).val()) {
        //$(this).parents('p').addClass('warning');
    } else {
        $('#'+closest_region+'_links .' + activeComponent + ' .rules-icon').removeClass('slds-hide');
        $('#'+closest_region+'_links .slds-marker').removeClass('slds-hide');

    }
});



//edit rules from click on clock
$('.rules-text-icon button').click(function() {
    $('.help-text').toggleClass('slds-hide');
    //now attach here the popover and show it!
});


$(function() {
    $(".clickspot").draggable();
    //$('.clickspot').drag().drag();
});


//rules page
//check rules
$('#page-rule-from').blur(function() {
    if (!$(this).val()) {
        //$(this).parents('p').addClass('warning');
    } else {
        $('#toast-rules').toggleClass('slds-hide');
    }
});


$('#toast-rules .close-toast-2').click(function() {
    $('#toast-rules').toggleClass('slds-hide');
});








//SET FOCAL Point
// Credit: https://github.com/jonom/jquery-focuspoint
// Credit: https://github.com/jonom/jquery-focuspoint

//$('.focal-holder').css('background-image','url('+$('.set-focal-point').attr('src')+')');

$('.set-focal-point').click(function(e){

  var imageW = $(this).width();
  var imageH = $(this).height();

  //Calculate FocusPoint coordinates
  var offsetX = e.pageX - $(this).offset().left;
  var offsetY = e.pageY - $(this).offset().top;

  //Calculate CSS Percentages
  var percentageX = (offsetX/imageW)*100;
  //var percentageY = (offsetY/imageH)*100;
  //there must be a bug in here ... why is *10 working???
  var percentageY = (offsetY/imageH)*10;
  var backgroundPosition = percentageX.toFixed(0) + '% ' + percentageY.toFixed(0) + '%';

  //Move indicator
  $('.circle').css('top',(offsetY-10)+'px');
  $('.circle').css('left',(offsetX-10)+'px');
  // Set positioning
  $('.focal-holder').css('background-position',backgroundPosition);


});

// Hide image while resizing
var resizing = false;
$(window).resize(function(){
  if(resizing !== false) {
    clearTimeout(resizing);
    $('img').css('opacity', 0);
 }
 resizing = setTimeout(function() {
   $('img').css('opacity', 1);
 }, 1000);

});


$('#input-pagename').keyup(function(e) {
    var txtVal = $(this).val();
    //$('p').html("123.This is,, :ravi".replace(/[\. ,:-]+/g, "-"));

    //$('#input-pageid').val(txtVal);
    //$('#input-pageid').html(txtVal);
    $('#input-pageid').html(txtVal.replace(/[\. ,:-]+/g, "-"));
});




$('.button--add-component').click(function() {
  closest_region = $(this).closest('.region').attr('id');
  $('.region_component_selector').toggleClass('slds-hide');
  return false;
});

$('.button--add-component-side').click(function() {
  //closest_region = $(this).closest('.region').attr('id');
  var name_links = $(this).closest('.region').attr('id');
  var arr =  name_links.split('_');
  closest_region = arr[0];

  $('.region_component_selector').toggleClass('slds-hide');
  var name_links = undefined;
  var arr = undefined;

  return false;
});








//MEDIA SELECTOR
$('.add-mediaselector-dummy').click(function() {
    selected_image = undefined;
    $('.mediaselector-component-editor .image-figure-thumb').attr('src', '/assets/placeholder.png');
    $('.mediaselector-component-editor .file-name').html('No Image assigned');


    $('#banner-checkbox_everyone').prop('checked', false);
    $('#banner-checkbox_customergroupa').prop('checked', false);
    $('#banner-checkbox_customergroupb').prop('checked', false);


    var countRechts = cloneCountA++;

    var component_placeholder = $('#dummy_container .my_mediaselector_dummy li').clone(true, true).attr('id','item'+countRechts).addClass('item').addClass('item').addClass('item'+countRechts);
    var navigator_placeholder = $('#dummy_container .my_mediaselector_navigator li').clone(true, true).attr('id','item'+countRechts+'_links').addClass('item'+countRechts);

    //component_placeholder.appendTo('#'+closest_region+' ul').hide().fadeIn(600);
    //navigator_placeholder.appendTo('#'+closest_region+'_links ul').hide().fadeIn(600);


    component_placeholder.appendTo('#'+closest_region+' .region_container').hide().fadeIn(600);
    navigator_placeholder.appendTo('#'+closest_region+'_links .region_container').hide().fadeIn(600);


    //now open editor
    activeComponent = undefined;
    activeComponent = $(component_placeholder).attr('id');

    //add 1 to component count
    regionlimit = $('#'+closest_region+'_links .region_limit').text();
    regionlimit = Number(regionlimit) + 1;

    $('#'+closest_region+'_links .region_limit').text('');
    $('#'+closest_region+'_links .region_limit').text(regionlimit);

    $('.region_component_selector').toggleClass('slds-hide');
    $('.mediaselector-component-editor').toggleClass('slds-hide');

    $('.modal-content-id-37 .tab_general').addClass('slds-active');
    return false;
});

//BANNER COMPONENT
$('.mediaselector-component-editor .image-figure, .add-image').click(function() {
    callerComponent = 'banner';
    $('.media-picker').toggleClass('slds-hide');
    $('.mediaselector-component-editor').toggleClass('slds-hide');
    $('.product-component-editor').addClass('slds-hide');
});

$('.media-component button.js-trigger-edit-component').click(function() {
    activeComponent = undefined;
    activeComponent = $(this).closest('li').attr('id');

    $('#banner-checkbox_everyone').prop('checked', false);
    $('#banner-checkbox_customergroupa').prop('checked', false);
    $('#banner-checkbox_customergroupb').prop('checked', false);


    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
      $('#banner-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
      $('#banner-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
      $('#banner-checkbox_customergroupb').prop('checked', true);
    }


    return false;
});


$('.media-component-editor button.trigger-save-modal').click(function() {
    selected_text = $('.slds-rich-text-area__content').html();
    selected_header = $('.slds-input-header').val();
    $('#'+ activeComponent + ' .text-holder').html(selected_text);
    $('#'+ activeComponent + ' .header-holder').html(selected_header);

    return false;
});

//IMAGE SELECT
$('.image-thumb').click(function() {
    //selected_image = $(this).find('h2').text();
    selected_image = $(this).closest('a').find('img').attr('src');
    $('.slds-file_card').removeClass('selected');
    $(this).closest('.slds-file_card').addClass('selected');
    return false;
});

//IMAGE SAVE
$('.picker .trigger-save-modal').click(function() {
    if(callerComponent == 'banner'){
      $('.mediaselector-component-editor .image-figure-thumb').attr('src', selected_image);
      $('.mediaselector-component-editor .file-name').text(selected_image);
      $('.picker').addClass('slds-hide');
      $('.circle').toggleClass('slds-hide');
      $('.mediaselector-component-editor').toggleClass('slds-hide');
    }else{
      $('#editor_banner .image-figure-thumb').attr('src', selected_image);
      $('#editor_banner .file-name').text(selected_image);
      $('.picker').addClass('slds-hide');
      $('.circle').toggleClass('slds-hide');
      $('.product-component-editor').toggleClass('slds-hide');

    }
});

//NOW CLOSE PICKER AND SET IMAGE
$('.mediaselector-component-editor .trigger-save-modal').click(function() {
    $('.mediaselector-component-editor').toggleClass('slds-hide');
    $('#'+ activeComponent + ' .image-holder').css('background-image', 'url(' + selected_image + ')');
    $('#'+ activeComponent + ' .image-holder span.no-image').addClass('slds-hide');

    banner_header = undefined;
    banner_sub = undefined;
    banner_header = $('.text-banner-header').val();
    banner_sub = $('.text-banner-sub').val();

    $('#'+ activeComponent + ' .banner-header').html(banner_header);
    $('#'+ activeComponent + ' .banner-sub').html(banner_sub);

    $('.text-banner-header').val('');
    $('.text-banner-sub').val('');
});


//BANNER COMPONENT EDIT
$('.placeholder-component-37 .js-trigger-edit-component, .js-trigger-media-edit-component').click(function() {
    activeComponent = undefined;
    activeComponent = $(this).closest('li').attr('id');

    $('#banner-checkbox_everyone').prop('checked', false);
    $('#banner-checkbox_customergroupa').prop('checked', false);
    $('#banner-checkbox_customergroupb').prop('checked', false);


    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
        $('#banner-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
        $('#banner-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
        $('#banner-checkbox_customergroupb').prop('checked', true);
    }


    //GET IMAGE
    //imgUrl = $(this).closest('.placeholder').find('.image-holder').css('background-image');
    imgUrl = $('#'+activeComponent).find('.image-holder').css('background-image');

    patt=/\"|\'|\)/g;
    selected_image = '/assets/'+imgUrl.split('/').pop().replace(patt,'');

    //GET TEXTS
    banner_header = $('#' + activeComponent).find('.title').text();
    banner_sub =    $('#' + activeComponent).find('.sub').text();

    $('.mediaselector-component-editor .image-figure-thumb').attr('src', selected_image);

    //SET TAB
    $('.modal-content-id-37 .tab_general').addClass('slds-active');
    $('.mediaselector-component-editor .text-banner-header').val(banner_header);
    $('.mediaselector-component-editor .text-banner-sub').val(banner_sub);
    $('.mediaselector-component-editor').toggleClass('slds-hide');
});



$('.js-trigger-media-edit-rules').click(function() {
    activeComponent = undefined;
    activeComponent = $(this).closest('li').attr('id');

    if(activeComponent.match('_links')) {
      arr = activeComponent.split('_');
      activeComponent = arr[0];
      arr = undefined;
    }

    $('#banner-checkbox_everyone').prop('checked', false);
    $('#banner-checkbox_customergroupa').prop('checked', false);
    $('#banner-checkbox_customergroupb').prop('checked', false);


    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
        $('#banner-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
      $('#banner-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
      $('#banner-checkbox_customergroupb').prop('checked', true);
    }



    //GET IMAGE
    //imgUrl = $(this).closest('.placeholder').find('.image-holder').css('background-image');
    imgUrl = $('#'+activeComponent).find('.image-holder').css('background-image');

    patt=/\"|\'|\)/g;
    selected_image = '/assets/'+imgUrl.split('/').pop().replace(patt,'');

    //GET TEXTS
    banner_header = $('#'+ activeComponent).find('.title').text();
    banner_sub =    $('#'+ activeComponent).find('.sub').text();

    $('.mediaselector-component-editor .image-figure-thumb').attr('src', selected_image);

    //SET TAB
    $('.modal-content-id-37 .tab_rules').addClass('slds-active');
    $('.mediaselector-component-editor .text-banner-header').val(banner_header);
    $('.mediaselector-component-editor .text-banner-sub').val(banner_sub);
    $('.mediaselector-component-editor').toggleClass('slds-hide');

    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
      $('#banner-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
      $('#banner-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
      $('#banner-checkbox_customergroupb').prop('checked', true);
    }


});



//DELETE ANY COMPONENT
$('.js-trigger-delete-component').click(function() {
    activeComponent = undefined;
    activeComponent = $(this).closest('li').attr('id');


    if(activeComponent.match('_links')) {
      arr = activeComponent.split('_');
      activeComponent = arr[0];
      arr = undefined;
    }

    $('.delete-component').toggleClass('slds-hide');

    return false;
});
$('.delete-component .action-delete-component').click(function() {
    $('#'+closest_region+'_links .slds-marker').addClass('slds-hide');
    $('#'+closest_region+'_links .rules-icon').addClass('slds-hide');
    $('.delete-component').toggleClass('slds-hide');

    $('#'+ activeComponent).fadeOut(600, function() {
      $('#'+activeComponent+'_links').remove();
      $('#'+activeComponent).remove();
    });

    //substract 1 from component count
    regionlimit = $('#'+closest_region+'_links .region_limit').text();
    regionlimit = Number(regionlimit) - 1;
    $('#'+closest_region+'_links .region_limit').text('');
    $('#'+closest_region+'_links .region_limit').text(regionlimit);

    return false;
});








//SET FOCAL Point
// Credit: https://github.com/jonom/jquery-focuspoint
// Credit: https://github.com/jonom/jquery-focuspoint

//$('.focal-holder').css('background-image','url('+$('.set-focal-point').attr('src')+')');

$('.set-focal-point').click(function(e){

  var imageW = $(this).width();
  var imageH = $(this).height();

  //Calculate FocusPoint coordinates
  var offsetX = e.pageX - $(this).offset().left;
  var offsetY = e.pageY - $(this).offset().top;

  //Calculate CSS Percentages
  var percentageX = (offsetX/imageW)*100;
  //var percentageY = (offsetY/imageH)*100;
  //there must be a bug in here ... why is *10 working???
  var percentageY = (offsetY/imageH)*10;
  var backgroundPosition = percentageX.toFixed(0) + '% ' + percentageY.toFixed(0) + '%';

  //Move indicator
  $('.circle').css('top',(offsetY-10)+'px');
  $('.circle').css('left',(offsetX-10)+'px');
  // Set positioning
  $('.focal-holder').css('background-position',backgroundPosition);


});

// Hide image while resizing
var resizing = false;
$(window).resize(function(){
  if(resizing !== false) {
    clearTimeout(resizing);
    $('img').css('opacity', 0);
 }
 resizing = setTimeout(function() {
   $('img').css('opacity', 1);
 }, 1000);

});


//PRODUCT SELECTOR
$('.add-product-dummy').click(function() {
    selected_image = undefined;
    $('#editor_banner .image-figure-thumb').attr('src', '/assets/placeholder.png');
    $('#editor_banner .file-name').html('No Image assigned');

    var countRechts = cloneCountA++;

    var component_placeholder = $('#dummy_container .my_product_dummy li').clone(true, true).attr('id','item'+countRechts).addClass('item').addClass('item'+countRechts);
    var navigator_placeholder = $('#dummy_container .my_product_navigator li').clone(true, true).attr('id','item'+countRechts+'_links').addClass('item'+countRechts);
    //var navigator_placeholder = $('<li>placeholder</li>').clone(true, true).attr('id','item'+countRechts+'_left').addClass('item'+countRechts);

    component_placeholder.appendTo('#'+closest_region+' .region_container').hide().fadeIn(600);
    navigator_placeholder.appendTo('#'+closest_region+'_links .region_container').hide().fadeIn(600);


    //now open editor
    activeComponent = undefined;
    activeComponent = $(component_placeholder).attr('id');


    //add 1 to component count
    regionlimit = $('#'+closest_region+'_links .region_limit').text();
    regionlimit = Number(regionlimit) + 1;
    $('#'+closest_region+'_links .region_limit').text('');
    $('#'+closest_region+'_links .region_limit').text(regionlimit);

    $('.region_component_selector').toggleClass('slds-hide');
    $('.product-component-editor').toggleClass('slds-hide');

    $('.modal-content-id-product .tab_general').addClass('slds-active');
    $('.product-link').val('');

    return false;
});



//PRODUCT COMPONENT
$('#editor_banner .add-image').click(function() {
  callerComponent = 'product';
  $('.product-component-editor').addClass('slds-hide');
  $('.modal-editor-37').addClass('slds-hide');
  $('.mediaselector-component-editor').addClass('slds-hide');
});
$('.product-component button.js-trigger-edit-component').click(function() {
    activeComponent = undefined;
    activeComponent = $(this).closest('li').attr('id');

    $('#product-checkbox_everyone').prop('checked', false);
    $('#product-checkbox_customergroupa').prop('checked', false);
    $('#product-checkbox_customergroupb').prop('checked', false);


    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
      $('#product-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
      $('#product-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
      $('#product-checkbox_customergroupb').prop('checked', true);
    }


    return false;
});
$('#editor_banner button.trigger-save-modal').click(function() {
    selected_text = $('.slds-rich-text-area__content').html();
    selected_header = $('.slds-input-header').val();
    $('#'+ activeComponent + ' .text-holder').html(selected_text);
    $('#'+ activeComponent + ' .header-holder').html(selected_header);
    $('#'+ activeComponent + ' .linked-product').html(selected_product_name);

    selected_product_name = undefined;
    $('.product-link').val('');

    return false;
});

//NOW CLOSE PICKER AND SET IMAGE
$('#editor_banner .trigger-save-modal').click(function() {
    $('.product-component-editor').toggleClass('slds-hide');
    $('#'+ activeComponent + ' .image-holder').css('background-image', 'url(' + selected_image + ')');
    $('#'+ activeComponent + ' .image-holder span.no-image').addClass('slds-hide');

    banner_header_product = undefined;
    banner_header_product = $('.text-banner-header-product').val();
    $('#'+ activeComponent + ' .banner-header-product').html(banner_header_product);

    $('.text-banner-header-product').val('');
});


//PRODUCT COMPONENT EDIT
$('.placeholder-component-product .js-trigger-edit-component, .js-trigger-product-edit-component').click(function() {
    activeComponent = undefined;
    activeComponent = $(this).closest('li').attr('id');

    if(activeComponent.match('_links')) {
      arr = activeComponent.split('_');
      activeComponent = arr[0];
      arr = undefined;
    }


    $('#product-checkbox_everyone').prop('checked', false);
    $('#product-checkbox_customergroupa').prop('checked', false);
    $('#product-checkbox_customergroupb').prop('checked', false);


    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
      $('#product-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
      $('#product-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
      $('#product-checkbox_customergroupb').prop('checked', true);
    }


    //GET IMAGE
    imgUrl = $('#'+activeComponent).find('.image-holder').css('background-image');

    patt=/\"|\'|\)/g;
    selected_image = '/assets/'+imgUrl.split('/').pop().replace(patt,'');


    selected_product_name = undefined;
    selected_product_name =  $('#'+ activeComponent + ' .linked-product').text();

    //GET TEXTS
    banner_header_product = $('#'+ activeComponent).find('.title').text();

    $('#editor_banner .image-figure-thumb').attr('src', selected_image);
    $('.product-link').val(selected_product_name);


    //SET TAB
    $('.modal-content-id-product .tab_general').addClass('slds-active');
    $('#editor_banner .text-banner-header-product').val(banner_header_product);
    $('.product-component-editor').toggleClass('slds-hide');

    selected_product_name = undefined;

});


//PRODUCT RULES EDIT
$('.js-trigger-product-edit-rules').click(function() {
    activeComponent = undefined;
    activeComponent = $(this).closest('li').attr('id');

    if(activeComponent.match('_links')) {
      arr = activeComponent.split('_');
      activeComponent = arr[0];
      arr = undefined;
    }


    $('#banner-checkbox_everyone').prop('checked', false);
    $('#banner-checkbox_customergroupa').prop('checked', false);
    $('#banner-checkbox_customergroupb').prop('checked', false);


    //GET IMAGE
    //imgUrl = $(this).closest('.placeholder').find('.image-holder').css('background-image');
    imgUrl = $('#'+activeComponent).find('.image-holder').css('background-image');

    patt=/\"|\'|\)/g;
    selected_image = '/assets/'+imgUrl.split('/').pop().replace(patt,'');

    selected_product_name = undefined;
    selected_product_name =  $('#'+ activeComponent + ' .linked-product').text();

    //GET TEXTS
    banner_header_product = $('#'+ activeComponent).find('.title').text();

    $('#editor_banner .image-figure-thumb').attr('src', selected_image);
    $('.product-link').val(selected_product_name);


    //SET TAB
    $('.modal-content-id-product .tab_rules').addClass('slds-active');
    $('#editor_banner .text-banner-header-product').val(banner_header_product);
    $('.product-component-editor').toggleClass('slds-hide');

    selected_product_name = undefined;

    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
      $('#banner-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
      $('#banner-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
      $('#banner-checkbox_customergroupb').prop('checked', true);
    }


});


//PRODUCT PICKER SELECT COMPONENT
$('.add-product').click(function() {
    $('.product-component-editor').toggleClass('slds-hide');
    $('#cat-pick').toggleClass('slds-hide');
    //$('.product-picker').toggleClass('slds-hide');
    return false;
});


//FILTER PRODUCT TABLE

$("#kwd_search").keyup(function() {
    if ($(this).val() != "") {
        $("#my-table tbody>tr").hide();
        $("#my-table td:contains-ci('" + $(this).val() + "')").parent("tr").show();
    } else {
        $("#my-table tbody>tr").show();
    }
});
$.extend($.expr[":"], {
    "contains-ci": function(elem, i, match, array) {
        return (elem.textContent || elem.innerText || $(elem).text() || "").toLowerCase().indexOf((match[3] || "").toLowerCase()) >= 0;
    }
});


//SELECT PRODUCT
$('.slds-checkbox_faux').click(function() {
    selected_product_name = undefined;
    selected_product_brand = undefined;
    selected_product_price = undefined;
    selected_product_id = undefined;


    selected_product_name = $(this).closest('tr').find('.product-name').html();
    selected_product_brand = $(this).closest('tr').find('.product-brand').html();
    selected_product_price = $(this).closest('tr').find('.product-price').html();
    selected_product_image = $(this).closest('tr').find('.prod_img').attr('src');
});

$('.product-picker button.trigger-save-modal').click(function() {

    $('.product-picker').toggleClass('slds-hide');
    $('.product-component-editor').toggleClass('slds-hide');

    $('.product-picker div.list-empty').toggleClass('slds-hide');
    $('.product-picker div.list-full').toggleClass('slds-hide');

    $('.product-link').val(selected_product_name);


    return false;
});


//ROW COMPONENT - ADD
$('.add-row').click(function() {

    var countRechts = cloneCountA++;

    var component_placeholder = $('#dummy_container .my_row_dummy li').clone(true, true).attr('id','item'+countRechts).addClass('item'+countRechts);
    var navigator_placeholder = $('#dummy_container .my_row_navigator li').clone(true, true).attr('id','item'+countRechts+'_links').addClass('item'+countRechts);

    component_placeholder.appendTo($('#'+closest_region+' > .region_container')).hide().fadeIn(600);
    navigator_placeholder.appendTo('#'+closest_region+'_links .region_container').hide().fadeIn(600);





    //now open editor
    activeComponent = undefined;
    activeComponent = $(component_placeholder).attr('id');


    //add 1 to component count
    regionlimit = $('#'+closest_region+'_links .region_limit').text();
    regionlimit = Number(regionlimit) + 1;
    $('#'+closest_region+'_links .region_limit').text(regionlimit);


    $('.region_component_selector').toggleClass('slds-hide');

    $('.row-component-editor').toggleClass('slds-hide');
    $('.row-component-editor .tab_general').addClass('slds-active');

    return false;
});


//ROW COMPONENT - EDIT
$('.placeholder-component-row .js-trigger-edit-component, .js-trigger-row-edit-component').click(function() {
    activeComponent = undefined;
    activeComponent = $(this).closest('li').attr('id');

    if(activeComponent.match('_links')) {
      arr = activeComponent.split('_');
      activeComponent = arr[0];
      arr = undefined;
    }


    var edit_the_row = 'yes';
    $('#row-checkbox_everyone').prop('checked', false);
    $('#row-checkbox_customergroupa').prop('checked', false);
    $('#row-checkbox_customergroupb').prop('checked', false);


    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
      $('#row-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
      $('#row-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
      $('#row-checkbox_customergroupb').prop('checked', true);
    }


    //SET TAB
    $('.modal-content-id-row .tab_general').addClass('slds-active');
    $('.row-component-editor').toggleClass('slds-hide');
});
$('.row-component-editor button.trigger-save-modal').click(function() {
    function setAllInvisible(){
      //$('#'+closest_region+' #'+activeComponent+' .layout-container > div.region').addClass('slds-hide');
      $('#'+closest_region+' #'+activeComponent+' .layout-container > div.region').remove();
    }
    function addRegions() {
      for (i = 0; i < 4; i++){
        //addSubRegions();
        var countRechts = cloneCountA++;
        $('#'+closest_region+'        #'+activeComponent+'  .layout-container').first().append($('#region_container').clone(true, true).attr('id','region_sub_'+countRechts).addClass('slds-hide').addClass('regionstuff-'+countRechts));
      }
      $('#'+closest_region+' #'+activeComponent+' .layout-container div.region').slice(selected_layout).removeClass('slds-hide').addClass('slds-show');
    }

    setAllInvisible();
    addRegions();

    $('.row-component-editor').toggleClass('slds-hide');
    return false;
});


$('.row-one').click(function() {
  selected_layout = 3;
  return false;
});
$('.row-two').click(function() {
  selected_layout = 2;
  return false;
});
$('.row-three').click(function() {
  selected_layout = 1;
  return false;
});
$('.row-four').click(function() {
  selected_layout = 0;
  return false;
});






//RULE HANDLING



//ROW RULES EDIT
$('.js-trigger-row-edit-rules').click(function() {
    activeComponent = undefined;
    activeComponent = $(this).closest('li').attr('id');

    if(activeComponent.match('_links')) {
      arr = activeComponent.split('_');
      activeComponent = arr[0];
      arr = undefined;
    }


    $('#row-checkbox_everyone').prop('checked', false);
    $('#row-checkbox_customergroupa').prop('checked', false);
    $('#row-checkbox_customergroupb').prop('checked', false);


    //SET TAB
    $('.modal-content-id-row .tab_rules').addClass('slds-active');
    $('.row-component-editor').toggleClass('slds-hide');

    selected_product_name = undefined;

    //SET CHECKBOX VALUES
    if ($('#'+activeComponent).hasClass('Everyone')) {
      $('#row-checkbox_everyone').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupA')) {
      $('#row-checkbox_customergroupa').prop('checked', true);
    }
    if ($('#'+activeComponent).hasClass('CustomergroupB')) {
      $('#row-checkbox_customergroupb').prop('checked', true);
    }


});


$('.cg').change(function() {
    if(this.checked) {
        //$('#'+activeComponent+'.customergroup').val()
        //$('#'+activeComponent+'.customergroup').val($(this).val());
        //$('#'+activeComponent+' .customergroup_text').val() + $(this).val();
        $('#'+activeComponent).addClass($(this).val());

        $('#'+closest_region+'_links .' + activeComponent + ' .rules-icon').removeClass('slds-hide');
        $('#'+closest_region+'_links .slds-marker').removeClass('slds-hide');


    }else{
        $('#'+activeComponent).removeClass($(this).val());
        $('#'+closest_region+'_links .' + activeComponent + ' .rules-icon').addClass('slds-hide');
        $('#'+closest_region+'_links .slds-marker').addClass('slds-hide');

    }
});

$('#checkbox_everyone').change(function() {
  if(this.checked) {
    $('.item').hide();
    if ($('.item').hasClass('Everyone')) {
      $('.item').hide();
      $('.Everyone').show();
    }
  }
});

$('#checkbox_customergroupa').change(function() {
  if(this.checked) {
    $('.item').hide();
    if ($('.item').hasClass('CustomergroupA')) {
      $('.item').hide();
      $('.CustomergroupA').show();
    }
  }
});

$('#checkbox_customergroupb').change(function() {
  if(this.checked) {
    $('.item').hide();
    if ($('.item').hasClass('CustomergroupB')) {
      $('.item').hide();
      $('.CustomergroupB').show();
    }
  }
});


$("#btnSubmit").click(function(){
  $('input[name="language"]:checked').each(function() {
    selectedLanguage.push(this.value);
  });
});

$('#select-all-products').click(function () {
  $('.product-list .slds-checkbox_add-button input').prop('checked', true);
  $('.hrhr-1').removeAttr('disabled');
  $('#deselect-all-products, .deselect-all-products, #items-selected-more').toggleClass('slds-hide');
  $(this).toggleClass('slds-hide');
});

$('#deselect-all-products').click(function () {
  $('.product-list .slds-checkbox_add-button input').prop('checked', false);
  $('#select-all-products, .deselect-all-products, #items-selected-more').toggleClass('slds-hide');
  $(this).toggleClass('slds-hide');
  $('.slds-button_brand.hrhr-1').attr('disabled', 'disabled');
});



// Nested Categories Commerce Selector
$('#trigger-nested').click(function() {
  $('.slds-is-child').toggleClass('slds-hide');
  $(this).toggleClass('is-opened');
});

$('.app-trigger').click(function() {
  $(this).toggleClass('slds-is-open');
});

$('.hide-select-product-2').click(function() {
  $('#select-product-23').toggleClass('slds-hide');
  $('#select-product-23').toggleClass('slds-show');
});

$('.slds-checkbox_faux').click(function() {
  $('#items-selected, #remove-all-trigger').removeClass('slds-hide');
  $('.einstein-placeholder-item').addClass('slds-hide');
  $('.einstein-item').removeClass('slds-hide');
  $('.hrhr-1').removeAttr('disabled');
});

$('#remove-all-trigger').click(function() {
  $('#remove-all-trigger, #items-selected').addClass('slds-hide');
  $('.product-list .slds-checkbox_add-button input').prop('checked', false);
  $('.hrhr-1').prop('disabled', true);
});

$('#combobox-unique-id1').change(function() {
  $('#tab-default-1, #placeholder-img, #item-counter, #empty-state-text').toggleClass('slds-hide');
});

$('#combobox-unique-id2').change(function() {
  $('.product-tile[aria-level="2"], .product-tile[aria-level="3"]').removeAttr('aria-level');
  $('.trigger-nested, .cat-path').toggleClass('slds-hide');
});

$('.hrhr').click(function() {
  var $checkbox = $('input.is-child');
  $checkbox.toggleClass('is-inhereted');
});

$('.hide-assign-to').click(function() {
  $('#assign-to').toggleClass('slds-hide');
});

$('.slds-section__title-action').click(function() {
  $(this).parent().parent().toggleClass('slds-is-open');
});

$('.is-child.is-inhereted + .slds-checkbox_faux').click(function() {
  $(this).removeClass('is-inhereted');
});



$('#select-product').click(function() {
  $('#select-intro, #picker-tabs, #select-search, #empty-state, #combobox-unique-id2').toggleClass('slds-hide');
});

$('#select-category').click(function() {
  $('#select-intro, #picker-tabs, #select-search, #tab-default-2, #combobox-unique-id1').toggleClass('slds-hide');
  $('#tab-default-2').toggleClass('slds-show');
});


$('.is-child.is-inhereted + .slds-checkbox_faux').click(function() {
  $(this).removeClass('is-inhereted');
});

$('#picker-tabs .checker').on('change', function(){
   if(this.checked){
     $('#picker-tabs .checker').prop('disabled', true);
     $(this).prop('disabled', false);
     //var checked_cat = $('label[for="'+ $this.attr('id') +'"]');
     checked_cat = $(this).closest('.slds-checkbox_add-button').find('.checker').attr('id');
     $('#assign-success').prop('disabled', false);
   }else{
     $('#picker-tabs .checker').prop('disabled', false);
     checked_cat = '';
     $('#assign-success').prop('disabled', true);
   }
})

$('#assign-success, .hrhr-1').click(function() {
  $('#picker-tabs .checker').prop('checked', false);
  $('#picker-tabs .checker').prop('disabled', false);
  $('#picker-tabs .checker').removeClass('is-inhereted');
  $('#assign-success').prop('disabled', true);


  $('#editor_banner .image-figure-thumb').attr('src', 'assets/'+checked_cat+'.jpg');
  selected_image = 'assets/'+checked_cat+'.jpg';
  $('.product-link').val(checked_cat);
  $('#cat-pick').toggleClass('slds-hide');
  $('.product-component-editor').toggleClass('slds-hide');
});


*/



//- end js

});
</script>
