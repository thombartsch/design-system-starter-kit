var CSRFInjector=function(L,I,F){var H=L;var Q=I;var P=F;var R=true;var G=true;var U=true;var a=true;var M=false;var N=false;this.tokenName=function(){return H;};this.tokenValue=function(){return Q;};function S(e,d,c){if(e.addEventListener){e.addEventListener(d,c,false);X.add(e,d,c);}else{if(e.attachEvent){e["e"+d+c]=c;
e[d+c]=function(){e["e"+d+c](window.event);};e.attachEvent("on"+d,e[d+c]);X.add(e,d,c);}else{e["on"+d]=e["e"+d+c];}}}var X=function(){var c=[];return{listEvents:c,add:function(d,f,e){c.push(arguments);},flush:function(){var d,e;for(d=c.length-1;d>=0;d=d-1){e=c[d];if(e[0].removeEventListener){e[0].removeEventListener(e[1],e[2],e[3]);
}if(e[1].substring(0,2)!="on"){e[1]="on"+e[1];}if(e[0].detachEvent){e[0].detachEvent(e[1],e[2]);}e[0][e[1]]=null;}}};}();function Y(d,c){return d.indexOf(c)===0;}function V(d,c){return d.match(c+"$")==c;}function T(d,c){return d.indexOf(c)!==-1;}function O(){XMLHttpRequest.prototype._open=XMLHttpRequest.prototype.open;
XMLHttpRequest.prototype.open=function(g,d,e,c,f){this.url=d;if(this.onopen!=null){this.onopen.apply(this,arguments);}this._open.apply(this,[g,this.url,e,c,f]);};XMLHttpRequest.prototype._send=XMLHttpRequest.prototype.send;XMLHttpRequest.prototype.send=function(c){if(this.onsend!=null){this.onsend.apply(this,c);
}this._send.apply(this,arguments);};}function W(){var c=window.XMLHttpRequest;function d(){this.base=c?new c:new window.ActiveXObject("Microsoft.XMLHTTP");}function e(){return new d;}e.prototype=d.prototype;e.UNSENT=0;e.OPENED=1;e.HEADERS_RECEIVED=2;e.LOADING=3;e.DONE=4;e.prototype.status=0;e.prototype.statusText="";
e.prototype.readyState=e.UNSENT;e.prototype.responseText="";e.prototype.responseXML=null;e.prototype.onsend=null;e.prototype.onopen=null;e.url=null;e.onreadystatechange=null;e.prototype.open=function(k,h,i,g,j){var f=this;this.url=h;if(this.onopen!=null){this.onopen.apply(this,arguments);}this.base.onreadystatechange=function(){try{f.status=f.base.status;
}catch(l){}try{f.statusText=f.base.statusText;}catch(l){}try{f.readyState=f.base.readyState;}catch(l){}try{f.responseText=f.base.responseText;}catch(l){}try{f.responseXML=f.base.responseXML;}catch(l){}if(f.onreadystatechange!=null){f.onreadystatechange.apply(this,arguments);}};this.base.open(k,this.url,i,g,j);
};e.prototype.send=function(f){if(this.onsend!=null){this.onsend.apply(this,arguments);}this.base.send(f);};e.prototype.abort=function(){this.base.abort();};e.prototype.getAllResponseHeaders=function(){return this.base.getAllResponseHeaders();};e.prototype.getResponseHeader=function(f){return this.base.getResponseHeader(f);
};e.prototype.setRequestHeader=function(f,g){return this.base.setRequestHeader(f,g);};window.XMLHttpRequest=e;}function B(e,d){var c=false;if(e==d){c=true;}else{if(R==false){if(d.charAt(0)=="."){c=V(e,d);}else{c=V(e,"."+d);}}}return c;}function Z(f){var d=["demandware.static"];for(var c=0;c<d.length;
c++){var e=d[c];if(T(f,e)){return false;}}return true;}function J(j){if(j.substring(0,7)=="http://"||j.substring(0,8)=="https://"){var f="://";var d=j.indexOf(f);var c=j.substring(d+f.length);var h="";for(var e=0;e<c.length;e++){var g=c.charAt(e);if(g=="/"||g==":"||g=="#"){break;}else{h+=g;}}return B(document.domain,h)&&Z(j);
}else{if(j.charAt(0)=="#"){return false;}else{if(!Y(j,"//")&&(j.charAt(0)=="/"||j.indexOf(":")==-1)){return Z(j);}}}return false;}function A(c){var f=false;var e=c.getAttribute("action");if(e!=null&&J(e)){if(c[H]){c[H].value=Q;}else{var d=document.createElement("input");d.setAttribute("type","hidden");
d.setAttribute("name",H);d.setAttribute("value",Q);c.appendChild(d);}f=true;}return f;}function C(i){var l=i;var e=l.indexOf(H);if(e!=-1){if(M){var m=(e+H.length+1);var f=l.indexOf("&",e);var h=l.indexOf("#",e);var j=l.length;if(f>-1){if(h>-1){j=Math.min(f,h);}else{j=f;}}else{if(h>-1){j=h;}}var c=l.substring(m,j);
l=l.replace(c,Q);}}else{if(l.indexOf("#")!=-1){var d=l.split("#");d[0]=C(d[0]);var g=d[0];for(var k=1;k<d.length;k++){g=g+"#"+d[k];}l=g;}else{l=E(l);}}return l;}function E(d){var c=d;if(c.indexOf("?")!=-1){c=c+"&"+H+"="+Q;}else{c=c+"?"+H+"="+Q;}return c;}function K(f,c){var h=false;var d=f.getAttribute(c);
if(d==null||d.length==0){return false;}if(f.tagName=="IFRAME"){if(N){console.log("Skipping iframe: "+f.name);}return true;}if(f.tagName=="FORM"&&"post"!=f.getAttribute("method")){if(N){console.log("Skipping form with get method, instead add as a parameter: "+f.name);}return false;}if(d!=null&&J(d)){if(N){console.log("inject into "+c+" attribute: "+d);
}d=C(d);try{if(f.getAttribute(c)!==d){f.setAttribute(c,d);h=true;}}catch(g){}}return h;}function D(f){var g=f.all?f.all:f.getElementsByTagName("*");var c=g.length;for(var e=0;e<c;e++){var d=g[e];if(d.tagName.toLowerCase()=="form"){if(G==true){if(N){console.log("injecting into form: "+d.name);}var h=K(d,"action");
if(!h){A(d);}}}else{if(U==true){K(d,"src");K(d,"href");}}}}function b(){D(document);}this.inject=function(){if(B(document.domain,P)){if(N){console.log("valid!");}if(a==true){if(navigator.appName=="Microsoft Internet Explorer"){if(N){console.log("IE!");}W();}else{if(N){console.log("Not IE!");}O();}XMLHttpRequest.prototype.onopen=function(c){if(this.url!=null&&J(this.url)){if(N){console.log("Added to XHR: "+this.url);
}if(this.url.indexOf(H)==-1){this.url=C(this.url);}}};}S(window,"unload",X.flush);S(window,"load",function(){b();});}else{alert("CSRF Protection cannot be used in an unauthorized domain: "+P);}};this.injectInString=function(d){var c=new DOMParser().parseFromString(d,"text/xml");D(c);d=new XMLSerializer().serializeToString(c);
return d;};this.injectInDoc=function(c){return D(c);};this.injectInURL=function(c){if(J(c)){c=C(c);}return c;};this.updateToken=function(c){Q=c;M=true;this.injectInDoc(document);M=false;};};