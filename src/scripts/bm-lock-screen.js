(function(A){if(!window.DW){window.DW={};}DW.ScreenSaver=(function(){var C={};function E(M){C.opts=M;if(!C.interval){C.interval=window.setInterval(J,C.opts.defaultTimeout);}A(document).ready(function(){A("#login #loginform form").on("submit",function(N){N.preventDefault();N.stopPropagation();B(this);
});A("#Login_Button_AM").on("click",function(R){var N=window.open(undefined,"MsgWindow","width=800, height=750");try{var O;try{O=N.document.createElement("form");}catch(R){N.close();N=window.open(undefined,"MsgWindow","width=800, height=750");O=N.document.createElement("form");}O.setAttribute("action",C.opts.amUrl);
O.setAttribute("method","post");O.style.display="none";N.document.body.appendChild(O);var S=N.document.createElement("input");S.setAttribute("type","hidden");S.setAttribute("name","source");S.setAttribute("value","login_screensaver");O.appendChild(S);O.submit();}catch(R){}var Q=false;var V=false;function P(){window.removeEventListener("message",U);
if(V){window.clearInterval(V);V=false;}}function T(){if(!Q){Q=true;I();}}window.closeScreenSaver=function(W){if(window.BMCSRFInjector){window.BMCSRFInjector.updateToken(W);}P();T();};function U(W){if(W.source===N&&W.data==="closeScreensaver"){P();K(function(){T();D();});}}window.addEventListener("message",U);
V=window.setInterval(function(){if(N.closed){P();K(function(){T();D();});}},1000);});});}function D(M){if(window.BMCSRFInjector){A.ajax(C.opts.sessionCheckUrl,{cache:false,dataType:"json",data:{method:"RefreshCSRFToken",siteID:C.opts.domainId},type:"POST",success:function(O,N,P){if(O.success){window.BMCSRFInjector.updateToken(O.csrf_token);
}else{F();}},error:function(P,N,O){F();G(C.opts.messages.networkProblem);}});}}function K(M){A.ajax(C.opts.sessionCheckUrl,{cache:false,dataType:"json",data:{method:"GetSessionTimeout",siteID:C.opts.domainId},type:"POST",success:function(O,N,P){if(O.expirationtime>10000){M();}else{F();}},error:function(P,N,O){F();
G(C.opts.messages.networkProblem);}});}function J(){A.ajax(C.opts.sessionCheckUrl,{cache:false,dataType:"json",data:{method:"GetSessionTimeout",siteID:C.opts.domainId},type:"POST",success:function(N,M,O){if(N.expirationtime<10000){F();if(N.expirationtime===-1){G(C.opts.messages.sessionTimeout);}if(N.expirationtime===-2){L();
}}},error:function(O,M,N){if(!window.isLoginShown){F();G(C.opts.messages.networkProblem);}}});}function F(){if(!window.isLoginShown){window.isLoginShown=true;var M=A('<div id="lock-screen-veil" class="lock-screen__veil"></div>');A("body").append(M);var N;N=A("body>#login");A("body").append(N);N.css({zIndex:"10001",position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"});
N.show();if(C.opts.isExternalUser){A("#loginform").hide();A("#amform").show();}else{A("#loginform").show();A("#amform").hide();}}}function I(){window.isLoginShown=false;A("body>#lock-screen-veil").remove();A("#login #LoginForm_Password").val("");A("body>#login").hide();A("body>#login_am").hide();}function G(M){A("#login .login_message").html(M);
}function L(){window.location.href=C.opts.logoutUrl;}function B(M){M=A(M);A.ajax(C.opts.loginFormUrl,{cache:false,dataType:"json",type:"POST",data:M.serialize(),success:function(O,N,P){if(O.success){I();if(window.BMCSRFInjector){window.BMCSRFInjector.updateToken(O.csrf_token);}}else{H(O.error);}},error:function(P,N,O){A("#login #LoginForm_Password").val("").focus();
G(C.opts.messages.networkProblem);}});}function H(M){var N=M[0].code;if(Object.keys(C.opts.messages).indexOf(N)>=0){G(C.opts.messages[N]);A("#login #LoginForm_Password").val("").focus();}else{if(N==="SessionExpired"){L();}else{G(C.opts.messages.unknownError);A("#login #LoginForm_Password").val("").focus();
}}}return{start:function(M){E(M);},logout:function(){L();}};}());}(jQuery));